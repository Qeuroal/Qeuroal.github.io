<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/avatar.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.24/fancybox/fancybox.css" integrity="sha256-vQkngPS8jiHHH0I6ABTZroZk8NPZ7b+MUReOFE9UsXQ=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"qeuroal.top","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="第一个flask程序Flask(__name__)12345# 初始化一个Flask对象# Flask()# 需要传递一个参数 __name__#   1. 方便flask框架去寻找资源#   2. 方便flask插件比如Flask-Sqlalchemy出现错误的时候，好去寻找问题所在的位置    @app.route()1234567# @app.route是一个装饰器（可以看成url的后缀：1">
<meta property="og:type" content="article">
<meta property="og:title" content="137. Flask">
<meta property="og:url" content="http://qeuroal.top/2021/04/05/137/index.html">
<meta property="og:site_name" content="Qeuroal&#39;s Blog">
<meta property="og:description" content="第一个flask程序Flask(__name__)12345# 初始化一个Flask对象# Flask()# 需要传递一个参数 __name__#   1. 方便flask框架去寻找资源#   2. 方便flask插件比如Flask-Sqlalchemy出现错误的时候，好去寻找问题所在的位置    @app.route()1234567# @app.route是一个装饰器（可以看成url的后缀：1">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://qeuroal.top/2021/04/05/137/image-20210420130808780.png">
<meta property="og:image" content="http://qeuroal.top/2021/04/05/137/image-20210421151010215.png">
<meta property="og:image" content="http://qeuroal.top/2021/04/05/137/image-20210421151305897.png">
<meta property="og:image" content="http://qeuroal.top/2021/04/05/137/image-20210421153655349.png">
<meta property="og:image" content="http://qeuroal.top/2021/04/05/137/image-20210423111049125.png">
<meta property="og:image" content="http://qeuroal.top/2021/04/05/137/2.png">
<meta property="og:image" content="http://qeuroal.top/2021/04/05/137/image-20210423164012252.png">
<meta property="og:image" content="http://qeuroal.top/2021/04/05/137/image-20210423164434699.png">
<meta property="og:image" content="http://qeuroal.top/2021/04/05/137/image-20210423172011235.png">
<meta property="og:image" content="http://qeuroal.top/2021/04/05/137/image-20210424090542356.png">
<meta property="og:image" content="http://qeuroal.top/2021/04/05/137/image-20210424091536079.png">
<meta property="og:image" content="http://qeuroal.top/2021/04/05/137/image-20210424093103556.png">
<meta property="og:image" content="http://qeuroal.top/2021/04/05/137/image-20210424211318851.png">
<meta property="article:published_time" content="2021-04-05T08:01:17.000Z">
<meta property="article:modified_time" content="2025-10-01T23:18:39.377Z">
<meta property="article:author" content="Qeuroal">
<meta property="article:tag" content="python">
<meta property="article:tag" content="flask">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://qeuroal.top/2021/04/05/137/image-20210420130808780.png">


<link rel="canonical" href="http://qeuroal.top/2021/04/05/137/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://qeuroal.top/2021/04/05/137/","path":"2021/04/05/137/","title":"137. Flask"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>137. Flask | Qeuroal's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Qeuroal's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">静幽正治</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AAflask%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.</span> <span class="nav-text">第一个flask程序</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Flask-name"><span class="nav-number">1.1.</span> <span class="nav-text">Flask(__name__)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#app-route"><span class="nav-number">1.2.</span> <span class="nav-text">@app.route()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#app-run"><span class="nav-number">1.3.</span> <span class="nav-text">app.run():</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AEdebug%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.</span> <span class="nav-text">设置debug模式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">3.</span> <span class="nav-text">使用配置文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#URL%E4%BC%A0%E5%8F%82"><span class="nav-number">4.</span> <span class="nav-text">URL传参</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%8D%E8%BD%ACURL"><span class="nav-number">5.</span> <span class="nav-text">反转URL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A3%E8%BD%AC"><span class="nav-number">5.1.</span> <span class="nav-text">正转</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E8%BD%AC"><span class="nav-number">5.2.</span> <span class="nav-text">反转</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E8%AE%B2%E8%A7%A3"><span class="nav-number">5.3.</span> <span class="nav-text">函数讲解</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-number">6.</span> <span class="nav-text">页面跳转和重定向</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E8%AE%B2%E8%A7%A3-1"><span class="nav-number">6.1.</span> <span class="nav-text">函数讲解</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93%E5%92%8C%E5%8F%82%E6%95%B0"><span class="nav-number">7.</span> <span class="nav-text">模板渲染和参数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E6%B8%B2%E6%9F%93%E6%A8%A1%E6%9D%BF"><span class="nav-number">7.1.</span> <span class="nav-text">如何渲染模板</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E4%BC%A0%E5%8F%82"><span class="nav-number">7.2.</span> <span class="nav-text">模板传参</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E8%AE%B2%E8%A7%A3-2"><span class="nav-number">7.3.</span> <span class="nav-text">函数讲解</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E8%AE%BF%E9%97%AE%E5%B1%9E%E6%80%A7%E5%92%8C%E5%AD%97%E5%85%B8"><span class="nav-number">8.</span> <span class="nav-text">模板访问属性和字典</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0"><span class="nav-number">8.1.</span> <span class="nav-text">实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#template1-py"><span class="nav-number">8.1.1.</span> <span class="nav-text">template1.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#index-html"><span class="nav-number">8.1.2.</span> <span class="nav-text">index.html</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HTML"><span class="nav-number">9.</span> <span class="nav-text">HTML</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#if%E5%88%A4%E6%96%AD"><span class="nav-number">9.1.</span> <span class="nav-text">if判断</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95"><span class="nav-number">9.1.1.</span> <span class="nav-text">语法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#for%E5%BE%AA%E7%8E%AF%E9%81%8D%E5%8E%86%E5%88%97%E8%A1%A8%E5%92%8C%E5%AD%97%E5%85%B8"><span class="nav-number">9.2.</span> <span class="nav-text">for循环遍历列表和字典</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E5%85%B8%E9%81%8D%E5%8E%86"><span class="nav-number">9.2.1.</span> <span class="nav-text">字典遍历</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%97%E8%A1%A8%E9%81%8D%E5%8E%86"><span class="nav-number">9.2.2.</span> <span class="nav-text">列表遍历</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">9.3.</span> <span class="nav-text">过滤器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D%E5%92%8C%E8%AF%AD%E6%B3%95"><span class="nav-number">9.3.1.</span> <span class="nav-text">介绍和语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#default%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">9.3.2.</span> <span class="nav-text">default过滤器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#length%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">9.3.3.</span> <span class="nav-text">length过滤器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">9.3.4.</span> <span class="nav-text">常用的过滤器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%A7%E6%89%BF%E5%92%8Cblock"><span class="nav-number">9.4.</span> <span class="nav-text">继承和block</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%A7%E6%89%BF"><span class="nav-number">9.4.1.</span> <span class="nav-text">继承</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#block"><span class="nav-number">9.4.2.</span> <span class="nav-text">block</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#URL%E9%93%BE%E6%8E%A5"><span class="nav-number">9.5.</span> <span class="nav-text">URL链接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"><span class="nav-number">9.6.</span> <span class="nav-text">加载静态文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95-1"><span class="nav-number">9.6.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="nav-number">9.6.2.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="nav-number">9.7.</span> <span class="nav-text">注意点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="nav-number">9.7.1.</span> <span class="nav-text">装饰器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL"><span class="nav-number">10.</span> <span class="nav-text">MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%EF%BC%88win10%EF%BC%89"><span class="nav-number">10.1.</span> <span class="nav-text">安装（win10）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL-python%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%AE%89%E8%A3%85"><span class="nav-number">10.2.</span> <span class="nav-text">MySQL-python中间件介绍与安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#linux-macos"><span class="nav-number">10.2.1.</span> <span class="nav-text">linux, macos</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#windows%E7%B3%BB%E7%BB%9F"><span class="nav-number">10.2.2.</span> <span class="nav-text">windows系统</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Flask-SQLAlchemy%E7%9A%84%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%AE%89%E8%A3%85"><span class="nav-number">10.3.</span> <span class="nav-text">Flask-SQLAlchemy的介绍与安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Flask-SQLAlchemy%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">10.4.</span> <span class="nav-text">Flask-SQLAlchemy的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BB%BA%E8%A1%A8"><span class="nav-number">10.5.</span> <span class="nav-text">建表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQLAlchemy%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%9E%8B%E4%B8%8E%E8%A1%A8%E7%9A%84%E6%98%A0%E5%B0%84"><span class="nav-number">10.6.</span> <span class="nav-text">SQLAlchemy创建模型与表的映射</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4"><span class="nav-number">10.6.1.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B"><span class="nav-number">10.6.2.</span> <span class="nav-text">实例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQLAlchemy%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="nav-number">10.7.</span> <span class="nav-text">SQLAlchemy数据增删改查</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A2%9E"><span class="nav-number">10.7.1.</span> <span class="nav-text">增</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5"><span class="nav-number">10.7.2.</span> <span class="nav-text">查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%94%B9"><span class="nav-number">10.7.3.</span> <span class="nav-text">改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0"><span class="nav-number">10.7.4.</span> <span class="nav-text">删</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F"><span class="nav-number">10.7.5.</span> <span class="nav-text">注意</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Flask-SQLAlchemy%E5%A4%96%E9%94%AE%E5%8F%8A%E5%85%B6%E5%85%B3%E7%B3%BB"><span class="nav-number">11.</span> <span class="nav-text">Flask-SQLAlchemy外键及其关系</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%96%E9%94%AE"><span class="nav-number">11.1.</span> <span class="nav-text">外键</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%87%8A"><span class="nav-number">11.1.1.</span> <span class="nav-text">解释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A5%E5%85%85"><span class="nav-number">11.1.2.</span> <span class="nav-text">补充</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E5%AF%B9%E5%A4%9A"><span class="nav-number">11.2.</span> <span class="nav-text">多对多</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90"><span class="nav-number">11.2.1.</span> <span class="nav-text">例子</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-number">11.2.2.</span> <span class="nav-text">使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Flask-Script%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%AE%89%E8%A3%85"><span class="nav-number">12.</span> <span class="nav-text">Flask-Script的介绍和安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">12.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">12.2.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-1"><span class="nav-number">12.3.</span> <span class="nav-text">使用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%86%E5%BC%80-models-%E5%8F%8A%E8%A7%A3%E5%86%B3%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8"><span class="nav-number">13.</span> <span class="nav-text">分开 models 及解决循环引用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8"><span class="nav-number">13.1.</span> <span class="nav-text">循环引用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%EF%BC%9A"><span class="nav-number">13.1.1.</span> <span class="nav-text">解决办法：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E5%BC%80-models"><span class="nav-number">13.2.</span> <span class="nav-text">分开 models</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%EF%BC%9A"><span class="nav-number">13.2.1.</span> <span class="nav-text">注意：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#flask-migrate"><span class="nav-number">14.</span> <span class="nav-text">flask-migrate</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#db-init-app-app-%E4%B8%8D%E8%83%BD%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8-db-create-all-%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="nav-number">14.1.</span> <span class="nav-text">db.init_app(app)不能直接使用 db.create_all() 解决办法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="nav-number">14.2.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-1"><span class="nav-number">14.3.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-2"><span class="nav-number">14.4.</span> <span class="nav-text">使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="nav-number">14.4.1.</span> <span class="nav-text">相关命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E7%82%B9-1"><span class="nav-number">14.4.2.</span> <span class="nav-text">注意点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#manage-py-%E7%9A%84%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81"><span class="nav-number">14.4.3.</span> <span class="nav-text">manage.py 的相关代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#cookie%E5%92%8Csession"><span class="nav-number">15.</span> <span class="nav-text">cookie和session</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#cookie"><span class="nav-number">15.1.</span> <span class="nav-text">cookie</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#session"><span class="nav-number">15.2.</span> <span class="nav-text">session</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F-1"><span class="nav-number">15.2.1.</span> <span class="nav-text">注意</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#flask%E4%B8%ADsession%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="nav-number">15.3.</span> <span class="nav-text">flask中session工作机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#flask%E6%93%8D%E4%BD%9Csession"><span class="nav-number">15.4.</span> <span class="nav-text">flask操作session</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#session%E7%9A%84%E6%93%8D%E4%BD%9C%E6%96%B9%E5%BC%8F%EF%BC%9A"><span class="nav-number">15.4.1.</span> <span class="nav-text">session的操作方式：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AEsession%E7%9A%84%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4"><span class="nav-number">15.4.2.</span> <span class="nav-text">设置session的过期时间</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#get%E8%AF%B7%E6%B1%82%E5%92%8Cpost%E8%AF%B7%E6%B1%82"><span class="nav-number">16.</span> <span class="nav-text">get请求和post请求</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#get%E8%AF%B7%E6%B1%82"><span class="nav-number">16.1.</span> <span class="nav-text">get请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#post%E8%AF%B7%E6%B1%82"><span class="nav-number">16.2.</span> <span class="nav-text">post请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0"><span class="nav-number">16.3.</span> <span class="nav-text">获取参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F-2"><span class="nav-number">16.3.1.</span> <span class="nav-text">注意</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BF%9D%E5%AD%98%E5%85%A8%E5%B1%80%E9%81%8D%E5%8E%86%E7%9A%84g%E5%B1%9E%E6%80%A7"><span class="nav-number">17.</span> <span class="nav-text">保存全局遍历的g属性</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0-hook"><span class="nav-number">18.</span> <span class="nav-text">钩子函数(hook)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0"><span class="nav-number">18.1.</span> <span class="nav-text">钩子函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#before-request"><span class="nav-number">18.2.</span> <span class="nav-text">before_request</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#context-processor%EF%BC%88%E4%B8%8A%E4%B8%8B%E6%96%87%E5%A4%84%E7%90%86%E5%99%A8%EF%BC%89"><span class="nav-number">18.3.</span> <span class="nav-text">context_processor（上下文处理器）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8-1"><span class="nav-number">19.</span> <span class="nav-text">装饰器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%B2%E8%A7%A3"><span class="nav-number">19.1.</span> <span class="nav-text">讲解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9B%E9%98%B6%EF%BC%9A%E6%9C%89%E5%8F%82%E6%83%85%E5%86%B5%E4%B8%8B%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="nav-number">19.2.</span> <span class="nav-text">进阶：有参情况下的装饰器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%8D%E8%BF%9B%E9%98%B6%EF%BC%9A%E6%9C%89%E6%97%A0%E5%8F%82%E5%90%8C%E6%97%B6%E5%AD%98%E5%9C%A8%E6%83%85%E5%86%B5%E4%B8%8B%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="nav-number">19.3.</span> <span class="nav-text">再进阶：有无参同时存在情况下的装饰器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%8D%E8%BF%9B%E9%98%B6"><span class="nav-number">19.4.</span> <span class="nav-text">再进阶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%8D%E8%BF%9B%E9%98%B6-1"><span class="nav-number">19.5.</span> <span class="nav-text">再进阶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">19.6.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5"><span class="nav-number">20.</span> <span class="nav-text">实践</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Qeuroal"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Qeuroal</p>
  <div class="site-description" itemprop="description">大人者，不失其赤子之心</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">183</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Qeuroal" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Qeuroal" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://qeuroal.top/2021/04/05/137/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Qeuroal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Qeuroal's Blog">
      <meta itemprop="description" content="大人者，不失其赤子之心">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="137. Flask | Qeuroal's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          137. Flask
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-05 16:01:17" itemprop="dateCreated datePublished" datetime="2021-04-05T16:01:17+08:00">2021-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-10-02 07:18:39" itemprop="dateModified" datetime="2025-10-02T07:18:39+08:00">2025-10-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="第一个flask程序"><a href="#第一个flask程序" class="headerlink" title="第一个flask程序"></a>第一个flask程序</h1><h2 id="Flask-name"><a href="#Flask-name" class="headerlink" title="Flask(__name__)"></a><code>Flask(__name__)</code></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化一个Flask对象</span></span><br><span class="line"><span class="comment"># Flask()</span></span><br><span class="line"><span class="comment"># 需要传递一个参数 __name__</span></span><br><span class="line"><span class="comment">#   1. 方便flask框架去寻找资源</span></span><br><span class="line"><span class="comment">#   2. 方便flask插件比如Flask-Sqlalchemy出现错误的时候，好去寻找问题所在的位置</span></span><br></pre></td></tr></table></figure>



<h2 id="app-route"><a href="#app-route" class="headerlink" title="@app.route()"></a><code>@app.route()</code></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @app.route是一个装饰器（可以看成url的后缀：127.0.0.1:5000/login 的 /login）</span></span><br><span class="line"><span class="comment"># @开头，并且在函数的上面，说明是装饰器</span></span><br><span class="line"><span class="comment"># 这个装饰器的作用是做一个url和视图函数(习惯性的命名，就是这里的hello_world函数)的映射</span></span><br><span class="line"><span class="comment"># 127.0.0.1:5000 -&gt; 去请求hello_world这个函数然后将结果返回给浏览器</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> “我是第一个flask程序”</span><br></pre></td></tr></table></figure>

<h2 id="app-run"><a href="#app-run" class="headerlink" title="app.run():"></a><code>app.run()</code>:</h2><p>启动一个应用服务器，来接收用户的请求。</p>
<p>类似于:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">True</span>):</span><br><span class="line">	listen()</span><br></pre></td></tr></table></figure>

<h1 id="设置debug模式"><a href="#设置debug模式" class="headerlink" title="设置debug模式"></a>设置debug模式</h1><ol>
<li>在 <code>app.run()</code> 中传入一个关键字参数<code>debug</code>，<code>app.run(debug=True)</code>， 就设置当前项目为 <code>debug</code> 模式</li>
<li><code>debug</code> 模式的两大功能<ul>
<li>当程序出现问题时，可以在也米那种看到错误信息和出错的位置</li>
<li>只要修改了项目中的 <code>Python</code> 文件，程序会自动加载，不需要手动重新启动服务器</li>
</ul>
</li>
</ol>
<h1 id="使用配置文件"><a href="#使用配置文件" class="headerlink" title="使用配置文件"></a>使用配置文件</h1><ol>
<li><p>新建一个 <code>.py</code>文件，这里设置为 <code>config.py</code></p>
</li>
<li><p>然后设置大写，如：<code>DEBUG=True</code></p>
</li>
<li><p>与<code>app</code>进行关联</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 假设配置文件为config</span></span><br><span class="line"><span class="keyword">import</span> config</span><br><span class="line"></span><br><span class="line">app.config.from_object(config)</span><br></pre></td></tr></table></figure>
</li>
<li><p>还有许多的其他参数，都是放在这个配置文件中，比如 <code>SECRET_KEY</code> 和 <code>SQLALCHEMY</code> 这些配置都是在这个文件中</p>
</li>
</ol>
<h1 id="URL传参"><a href="#URL传参" class="headerlink" title="URL传参"></a><code>URL</code>传参</h1><ol>
<li><p>参数的作用：可以在相同的<code>url</code>，但是指定不同的参数，来加载不同的数据</p>
</li>
<li><p>在flask中如何使用参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/article/&lt;id&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">article</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;您请求的参数是：%s&quot;</span> %<span class="built_in">id</span></span><br></pre></td></tr></table></figure>

<ul>
<li>参数需要放在两个尖括号中</li>
<li>视图函数中需要放和<code>url</code>中的参数同名的参数</li>
</ul>
</li>
</ol>
<h1 id="反转URL"><a href="#反转URL" class="headerlink" title="反转URL"></a>反转<code>URL</code></h1><h2 id="正转"><a href="#正转" class="headerlink" title="正转"></a>正转</h2><p>通过<code>url</code>可以取到视图函数的内容</p>
<h2 id="反转"><a href="#反转" class="headerlink" title="反转"></a>反转</h2><ol>
<li>从视图函数到<code>url</code>的转换叫做反转<code>url</code>（通过视图函数的名称，可以得到指向的<code>url</code>）</li>
<li>用处<ul>
<li>在页面重定向的时候，会使用<code>url</code>反转</li>
<li>在模板中也会使用<code>url</code>反转</li>
</ul>
</li>
</ol>
<h2 id="函数讲解"><a href="#函数讲解" class="headerlink" title="函数讲解"></a>函数讲解</h2><ul>
<li><code>url_for()</code>: <ul>
<li><code>params</code>:视图函数名称, 视图函数对应的参数（如果视图函数有参数的话），如 <code>url_for(&quot;article&quot;, id=&quot;123&quot;)</code></li>
<li><code>return</code>:  视图函数对应的<code>url</code></li>
</ul>
</li>
</ul>
<h1 id="页面跳转和重定向"><a href="#页面跳转和重定向" class="headerlink" title="页面跳转和重定向"></a>页面跳转和重定向</h1><ol>
<li><p>用处：在用户访问一些需要登录的页面的时候，如果用户没有登录，那么可以让他重定向到登录页面</p>
</li>
<li><p>实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, redirect, url_for</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/question/&lt;isLogin&gt;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">question</span>(<span class="params">isLogin</span>):</span><br><span class="line">    <span class="keyword">if</span> isLogin == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;这是发布问答页面&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="函数讲解-1"><a href="#函数讲解-1" class="headerlink" title="函数讲解"></a>函数讲解</h2><ul>
<li><code>redirect()</code><ul>
<li><code>params</code>: <code>url</code>，如 <code>redirect(&quot;/login123/&quot;)</code>或者 <code>redirect(url_for(&quot;login&quot;))</code>，建议使用第二种，只要视图函数名字不变， <code>@app.route(/login123/)</code>里面的 <code>login123</code>怎么变都没关系</li>
</ul>
</li>
</ul>
<h1 id="模板渲染和参数"><a href="#模板渲染和参数" class="headerlink" title="模板渲染和参数"></a>模板渲染和参数</h1><h2 id="如何渲染模板"><a href="#如何渲染模板" class="headerlink" title="如何渲染模板"></a>如何渲染模板</h2><ol>
<li><p>模板放在 <code>templates</code> 文件夹下</p>
</li>
<li><p>从 <code>flask</code> 中导入 <code>render_template</code> 函数</p>
</li>
<li><p>在试图函数中，使用 <code>render_template</code> 函数渲染模板。</p>
<blockquote>
<p>注意：只需要填写模板的名字，不要填写 <code>templates</code> 这个文件夹的路径。如果在 <code>templates</code> 文件夹下创建了一个新的文件夹，那么就要添加上文件名（<code>render_template()</code> 函数的文件名是相对路径）</p>
</blockquote>
</li>
</ol>
<h2 id="模板传参"><a href="#模板传参" class="headerlink" title="模板传参"></a>模板传参</h2><ul>
<li>如果只有一个或者少量参数，直接在 <code>render_template()</code> 函数中添加关键字参数就可以了</li>
<li>如果有多个参数的时候，那么可以先把所有的参数放在字典中，然后在 <code>render_template</code> 中，使用 <code>**字典名</code> 把字典转换为关键参数传递进去，这样的代码更方便管理和应用</li>
</ul>
<h2 id="函数讲解-2"><a href="#函数讲解-2" class="headerlink" title="函数讲解"></a>函数讲解</h2><ul>
<li><code>render_template()</code><ul>
<li><code>params</code>: 渲染文件名（渲染文件放在template文件夹下）, <code>username = 用户名</code> (<code>username</code> 保证和渲染文件中的变量名保持一致), … 。如 <code>render_template(&quot;index.html&quot;, username = &quot;Qeuroal&quot;)</code>，</li>
<li>如果参数特别多的话，可以先定义一个字典(<code>context</code>)，然后把字典传入函数内，如 <code>render_template(&quot;index.html&quot;, **contet)</code></li>
</ul>
</li>
</ul>
<h1 id="模板访问属性和字典"><a href="#模板访问属性和字典" class="headerlink" title="模板访问属性和字典"></a>模板访问属性和字典</h1><p>在模板中如果要使用一个变量，语法是 <code>&#123;&#123; params &#125;&#125;</code></p>
<ul>
<li>访问类的属性：<ul>
<li>和在Python文件中一致</li>
<li>或者类似于这样： <code>Person[&quot;name&quot;]</code></li>
</ul>
</li>
<li>访问字典：<ul>
<li>和<code>py文件</code>一样： <code>dict[key]</code></li>
<li><code>dict.key</code></li>
</ul>
</li>
</ul>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="template1-py"><a href="#template1-py" class="headerlink" title="template1.py"></a><code>template1.py</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Person</span>():</span><br><span class="line">        name = <span class="string">&quot;Qeuroal&quot;</span></span><br><span class="line">        age = <span class="number">24</span></span><br><span class="line"></span><br><span class="line">    p = Person()</span><br><span class="line">    testDict = &#123;</span><br><span class="line">        <span class="string">&quot;key&quot;</span>: <span class="string">&quot;key&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    context = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;Qeuroal&quot;</span>,</span><br><span class="line">        <span class="string">&quot;gender&quot;</span>: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">        <span class="string">&quot;age&quot;</span>: <span class="number">24</span>,</span><br><span class="line">        <span class="string">&quot;person&quot;</span>: p,</span><br><span class="line">        <span class="string">&quot;testDict&quot;</span>: testDict</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a><code>index.html</code></h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    这是HTML文件中出现的文字</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名: &#123;&#123; username &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名: &#123;&#123; person.name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄: &#123;&#123; person[&quot;age&quot;] &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>key: &#123;&#123; testDict.key &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>value: &#123;&#123; testDict[&#x27;value&#x27;] &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h1><h2 id="if判断"><a href="#if判断" class="headerlink" title="if判断"></a>if判断</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if xxx and xxx %&#125;</span><br><span class="line">xxxx</span><br><span class="line">&#123;% elif xxx and xxx%&#125;</span><br><span class="line">xxxx</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">xxxx</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>if的使用和python中相差无几。</p>
</blockquote>
<h2 id="for循环遍历列表和字典"><a href="#for循环遍历列表和字典" class="headerlink" title="for循环遍历列表和字典"></a>for循环遍历列表和字典</h2><h3 id="字典遍历"><a href="#字典遍历" class="headerlink" title="字典遍历"></a>字典遍历</h3><blockquote>
<p>字典的遍历，语法和 <code>python</code> 一样，可以使用 <code>items()</code>, <code>keys()</code>, <code>values()</code>, <code>iteritems()</code>, <code>iterkeys()</code>, <code>itervalues()</code></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for k,v in user.items() %&#125;</span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; k &#125;&#125;: &#123;&#123; v &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endfor%&#125;</span><br></pre></td></tr></table></figure>

<h3 id="列表遍历"><a href="#列表遍历" class="headerlink" title="列表遍历"></a>列表遍历</h3><blockquote>
<p> 语法和 <code>python</code> 一样</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for website in websites %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; website &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><blockquote>
<p>作用对象是模板中的变量：</p>
<img data-src="/2021/04/05/137/image-20210420130808780.png" class="" title="image-20210420130808780">
</blockquote>
<h3 id="介绍和语法"><a href="#介绍和语法" class="headerlink" title="介绍和语法"></a>介绍和语法</h3><ul>
<li><p>介绍：过滤器可以处理变量，把原始的遍历经过处理后再展示出来。作用的对象是变量</p>
</li>
<li><p>语法：</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; avator|default(&quot;xxx&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="default过滤器"><a href="#default过滤器" class="headerlink" title="default过滤器"></a>default过滤器</h3><p>如果当前变量不存在，这时候可以指定默认值。</p>
<h3 id="length过滤器"><a href="#length过滤器" class="headerlink" title="length过滤器"></a>length过滤器</h3><p>求列表，字符串，字典，元组的长度。类似于：<code>python</code> 中的 <code>len()</code></p>
<h3 id="常用的过滤器"><a href="#常用的过滤器" class="headerlink" title="常用的过滤器"></a>常用的过滤器</h3><ul>
<li><code>abs(value)</code></li>
<li><code>default(value, defaultValue, boolean=false)</code></li>
<li><code>escape(value)</code></li>
<li><code>first(value)</code></li>
<li><code>format(value, *args, **kwargs)</code></li>
<li><code>last(value)</code></li>
<li><code>length(value)</code></li>
<li><code>join(value, d=&quot;&quot;)</code></li>
<li><code>safe(value)</code></li>
</ul>
<h2 id="继承和block"><a href="#继承和block" class="headerlink" title="继承和block"></a>继承和block</h2><h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><ul>
<li><p>作用：可以把一些公共的代码放在父模板中，避免每个模板写同样的代码</p>
</li>
<li><p>语法：</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果想在子模板中实现自己的内容：需要定义接口，类似于 <code>java</code> 的接口：html子模板需要实现自己内容，必须要放在父模板定义的接口里面，即block，不能在接口外面写代码</p>
</li>
</ul>
<h3 id="block"><a href="#block" class="headerlink" title="block"></a>block</h3><ul>
<li>作用：可以让子模板实现一些自己的需求。父模板需要提前定义好。</li>
<li>注意点：<ul>
<li>子模板中的代码，必须放在block块中；</li>
<li>可以定义多个 <code>block</code></li>
</ul>
</li>
</ul>
<h2 id="URL链接"><a href="#URL链接" class="headerlink" title="URL链接"></a>URL链接</h2><p>使用 <code>url_for(视图函数名称)</code> 可以反转成url。</p>
<h2 id="加载静态文件"><a href="#加载静态文件" class="headerlink" title="加载静态文件"></a>加载静态文件</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: red;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: black;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>样式代码一般不会写在模板中，因为：维护性差，一般样式文件抽取成 <code>css</code> 文件（<code>static</code> 文件夹中是存放静态文件的）</p>
<h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><p><code>url_for(&quot;static&quot;, filename=&quot;路径&quot;)</code></p>
<ul>
<li><p>如：<code>url_for(&quot;static&quot;, filename=&quot;css/index.css&quot;)</code></p>
</li>
<li><p>静态文件，flask会从 <code>static</code> 文件夹中开始寻找，所以不需要写 <code>static</code> 这个路径了</p>
</li>
<li><p>可以加载 <code>css</code>文件， <code>js</code> 文件，<code>image</code> 文件。</p>
</li>
</ul>
<h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;# 加载css文件 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&quot;</span><span class="attr">static</span>&quot;, <span class="attr">filename</span>=<span class="string">&quot;css/index.css&quot;</span>) &#125;&#125;&quot;&gt;</span></span><br><span class="line">&#123;# 加载js文件 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; url_for(&quot;</span><span class="attr">static</span>&quot;, <span class="attr">filename</span>=<span class="string">&quot;js/index.js&quot;</span>) &#125;&#125;&quot;&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&#123;# 加载image文件 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; url_for(&quot;</span><span class="attr">static</span>&quot;, <span class="attr">filename</span>=<span class="string">&quot;images/pdx.jpg&quot;</span>) &#125;&#125;&quot; <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h2><h3 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h3><ul>
<li>装饰器为 <code>@app.route(&#39;/login/&#39;)</code>，网址可以是：<code>http://127.0.0.1:5000/login</code> 和 <code>http://127.0.0.1:5000/login/</code></li>
<li>装饰器为 <code>@app.route(&#39;/login&#39;)</code>，网址只能是：<code>http://127.0.0.1:5000/login/</code></li>
</ul>
<h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h2 id="安装（win10）"><a href="#安装（win10）" class="headerlink" title="安装（win10）"></a>安装（win10）</h2><ul>
<li><p>我选择的是 <code>Server only</code></p>
</li>
<li><p>设置密码：</p>
 <img data-src="/2021/04/05/137/image-20210421151010215.png" class="" title="image-20210421151010215">
</li>
<li><p>打开命令行，并输入上一步设置好的密码</p>
 <img data-src="/2021/04/05/137/image-20210421151305897.png" class="" title="image-20210421151305897">
</li>
<li><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/mysql/">下载地址</a></p>
</li>
<li><p>一般直接下一步</p>
</li>
<li><p>设置初始密码命令：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -uroot password [password]</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果没有安装 <code>.net Framework 4</code>，就在那个提示框中，找到下载的 <code>url</code> 下载；</p>
</li>
<li><p>如果没有安装 <code>Microsoft visual C++ x64</code>，那么就需要谷歌或者百度下载这个软件进行安装即可。</p>
</li>
</ul>
<h2 id="MySQL-python中间件介绍与安装"><a href="#MySQL-python中间件介绍与安装" class="headerlink" title="MySQL-python中间件介绍与安装"></a>MySQL-python中间件介绍与安装</h2><h3 id="linux-macos"><a href="#linux-macos" class="headerlink" title="linux, macos"></a>linux, macos</h3><ol>
<li>进入虚拟环境</li>
<li>输入 <code>pip install mysql-python</code></li>
</ol>
<h3 id="windows系统"><a href="#windows系统" class="headerlink" title="windows系统"></a>windows系统</h3><ul>
<li><code>windows</code> 在这里<a target="_blank" rel="noopener" href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#mysql-python">下载</a>，看 <code>python</code> 安装的是32位还是64位，对应下载</li>
<li>进入虚拟环境： <code>conda activate 虚拟环境名</code></li>
<li>安装：<code>pip install mysqlclient-1.4.6-cp37-cp37m-win_amd64.whl</code></li>
</ul>
<h2 id="Flask-SQLAlchemy的介绍与安装"><a href="#Flask-SQLAlchemy的介绍与安装" class="headerlink" title="Flask-SQLAlchemy的介绍与安装"></a>Flask-SQLAlchemy的介绍与安装</h2><ul>
<li><p><code>ORM</code>: <code>Object Relationship Mapping</code> （关系模型映射）；</p>
</li>
<li><p><code>flask-sqlalchemy</code> 是一套 <code>ORM</code>框架</p>
</li>
<li><p>模型关系映射</p>
 <img data-src="/2021/04/05/137/image-20210421153655349.png" class="" title="image-20210421153655349">

<ul>
<li><code>delete(article1)</code>：把 <code>article</code>表中和<code>article1</code>属性对应相同的那条数据删除。</li>
<li>好处：ORM使得我们操作数据库非常简单，就像操作对象是一样的，非常方便。因为一个表就抽象成了一个类，一条数据就抽象成了该类的一个对象。</li>
</ul>
</li>
<li><p>安装：<code>pip install flask-sqlalhemy</code>，如果是在 <code>macos</code> 或者 <code>linux</code> 中没有权限的话这样安装： <code>sudo pip install flask-sqlalhemy</code></p>
</li>
</ul>
<h2 id="Flask-SQLAlchemy的使用"><a href="#Flask-SQLAlchemy的使用" class="headerlink" title="Flask-SQLAlchemy的使用"></a>Flask-SQLAlchemy的使用</h2><ol>
<li><p>初始化和设置数据库配置信息：</p>
<ul>
<li><p>使用 <code>flask_sqlalchemy</code> 中的 <code>SQLAlchemy</code> 进行初始化</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">db = SQLAlchemy(app)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>设置配置信息：在 <code>config.py</code> 文件中添加以下配置信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dialect+driver://username:password@host:port/database</span></span><br><span class="line">DIALECT = <span class="string">&quot;mysql&quot;</span></span><br><span class="line">DRIVER = <span class="string">&quot;mysqldb&quot;</span></span><br><span class="line">USERNAME = <span class="string">&quot;root&quot;</span></span><br><span class="line">PASSWORD = <span class="string">&quot;toor&quot;</span></span><br><span class="line">HOST = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">PORT = <span class="string">&quot;3306&quot;</span></span><br><span class="line">DATABASE = <span class="string">&quot;dbDemo1&quot;</span></span><br><span class="line"></span><br><span class="line">SQLALCHEMY_DATABASE_URI = <span class="string">&quot;&#123;&#125;+&#123;&#125;://&#123;&#125;:&#123;&#125;@&#123;&#125;:&#123;&#125;/&#123;&#125;?charset=utf8&quot;</span>.<span class="built_in">format</span>(DIALECT, DRIVER, USERNAME, PASSWORD, HOST, PORT, DATABASE)</span><br><span class="line"><span class="comment"># 去除警告</span></span><br><span class="line">SQLALCHEMY_TRACK_MODIFICATIONS = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加配置文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> config</span><br><span class="line"></span><br><span class="line">app.config.from_object(config)</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试是否连接成功</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.create_all()</span><br></pre></td></tr></table></figure>

<p>如果没有报错，说明配置没有问题，如果有错误，可以根据错误进行修改。</p>
</li>
</ol>
<h2 id="建表"><a href="#建表" class="headerlink" title="建表"></a>建表</h2><ol>
<li><code>cmd</code> 进入 <code>mysql</code>：<code>mysql -uroot -p</code></li>
<li><code>create database dbDemo1 charset utf8</code></li>
</ol>
<h2 id="SQLAlchemy创建模型与表的映射"><a href="#SQLAlchemy创建模型与表的映射" class="headerlink" title="SQLAlchemy创建模型与表的映射"></a>SQLAlchemy创建模型与表的映射</h2><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li><p>模型需要继承自 <code>db.Model</code>，然后需要映射到表中的属性，必须写成 <code>db.Column()</code>的数据类型</p>
</li>
<li><p>数据类型：</p>
<ul>
<li><code>db.Integer</code>: 整型</li>
<li><code>db.Sting</code>: <code>varchar</code>，<code>char</code>，需要指定最长的长度</li>
<li><code>db.Text</code>: <code>text</code></li>
</ul>
</li>
<li><p>其他参数</p>
<ul>
<li><code>primary_key</code>: 将这个字段设置为主键</li>
<li><code>autoincrement</code>: 这个主键为自增长</li>
<li><code>nullable</code>： 这个字段是否可以为空，默认为空，可以将这个值设置为 <code>False</code> ，在数据库中，这个值就不能为空了</li>
</ul>
</li>
<li><p>最后需要调用 <code>db.create_all()</code> 来将模型真正的创建到数据库中，<code>db.create_all()</code>只会映射一次。</p>
</li>
</ol>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"><span class="keyword">import</span> config</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config.from_object(config)</span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">创建article表</span></span><br><span class="line"><span class="string">create table article (</span></span><br><span class="line"><span class="string">    id int primary key autoincrement,</span></span><br><span class="line"><span class="string">    title varchar(100) not null,</span></span><br><span class="line"><span class="string">    content text not null</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 自己写的模型一定要继承sqlalchemy属性下的model模型, 字段-&gt;属性</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Article</span>(db.Model):</span><br><span class="line">    <span class="comment"># 如果不指定表名，默认为类名</span></span><br><span class="line">    __tablename__ = <span class="string">&quot;article&quot;</span></span><br><span class="line">    <span class="comment"># 属性id映射到字段id</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>, autoincrement=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># varchar, char -&gt; db.String(长度)</span></span><br><span class="line">    title = db.Column(db.String(<span class="number">100</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    content = db.Column(db.Text, nullable=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所有的模型映射到数据库的一张表</span></span><br><span class="line">db.create_all()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<h2 id="SQLAlchemy数据增删改查"><a href="#SQLAlchemy数据增删改查" class="headerlink" title="SQLAlchemy数据增删改查"></a>SQLAlchemy数据增删改查</h2><h3 id="增"><a href="#增" class="headerlink" title="增"></a>增</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增加</span></span><br><span class="line">article1 = Article(title=<span class="string">&quot;aaa&quot;</span>, content=<span class="string">&quot;bbb&quot;</span>)</span><br><span class="line">db.session.add(article1)</span><br><span class="line"><span class="comment"># 事务</span></span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure>

<h3 id="查"><a href="#查" class="headerlink" title="查"></a>查</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回的是Query(&lt;==&gt; list); .all()查找所有数据, .first()返回的第一条数据，如果没有，返回null</span></span><br><span class="line">result = Article.query.<span class="built_in">filter</span>(Article.title == <span class="string">&quot;aaa&quot;</span>).<span class="built_in">all</span>()</span><br><span class="line"><span class="built_in">print</span>(result[<span class="number">0</span>], <span class="built_in">type</span>(result[<span class="number">0</span>]))</span><br><span class="line">article1 = result[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(article1.title)</span><br><span class="line"><span class="built_in">print</span>(article1.content)</span><br></pre></td></tr></table></figure>

<h3 id="改"><a href="#改" class="headerlink" title="改"></a>改</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 先把要修改的地方查找出来</span></span><br><span class="line">article1 = Article.query.<span class="built_in">filter</span>(Article.title == <span class="string">&quot;aaa&quot;</span>).first()</span><br><span class="line"><span class="comment"># 2. 把这条数据，你需要修改的地方进行修改</span></span><br><span class="line">article1.title = <span class="string">&quot;new title&quot;</span></span><br><span class="line"><span class="comment"># 3. 做事务的提交</span></span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure>

<h3 id="删"><a href="#删" class="headerlink" title="删"></a>删</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 把需要删除的数据查找出来</span></span><br><span class="line">article1 = Article.query.<span class="built_in">filter</span>(Article.content == <span class="string">&quot;bbb&quot;</span>).first()</span><br><span class="line"><span class="comment"># 2. 把这条数据删除掉</span></span><br><span class="line">db.session.delete(article1)</span><br><span class="line"><span class="comment"># 3. 做事务提交</span></span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure>

<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ul>
<li>如果把增删改查放在 <code>@app.route(&quot;/&quot;)</code> 类似的视图函数中，访问一次 <code>url</code>，就会执行一遍相应的增删改查</li>
</ul>
<h1 id="Flask-SQLAlchemy外键及其关系"><a href="#Flask-SQLAlchemy外键及其关系" class="headerlink" title="Flask-SQLAlchemy外键及其关系"></a>Flask-SQLAlchemy外键及其关系</h1><h2 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">用户表</span></span><br><span class="line"><span class="string">sql语句:</span></span><br><span class="line"><span class="string">create table users (</span></span><br><span class="line"><span class="string">    id int primary key autoincrement,</span></span><br><span class="line"><span class="string">    username varchar(100) not null</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(db.Model):</span><br><span class="line">    __tablename__ = <span class="string">&quot;user&quot;</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>, autoincrement=<span class="literal">True</span>)</span><br><span class="line">    username = db.Column(db.String(<span class="number">100</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># password = db.Column(db.String(100), nullable=False)</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">文章表</span></span><br><span class="line"><span class="string">create table article (</span></span><br><span class="line"><span class="string">    id int primary key autoincrement,</span></span><br><span class="line"><span class="string">    title varchar(100) not null,</span></span><br><span class="line"><span class="string">    content text not null,</span></span><br><span class="line"><span class="string">    authorId int,</span></span><br><span class="line"><span class="string">    foreign key &quot;authorId&quot; references &quot;user.id&quot;</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Article</span>(db.Model):</span><br><span class="line">    __tablename__ = <span class="string">&quot;article&quot;</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>, autoincrement=<span class="literal">True</span>)</span><br><span class="line">    title = db.Column(db.String(<span class="number">100</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    content = db.Column(db.Text, nullable=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># 设置外键</span></span><br><span class="line">    authorId = db.Column(db.Integer, db.ForeignKey(<span class="string">&quot;user.id&quot;</span>))</span><br><span class="line">    <span class="comment"># params: 模型名, backref：反向引用；db.backref(), params: 反向引用的名字，</span></span><br><span class="line">    author = db.relationship(<span class="string">&quot;User&quot;</span>, backref=db.backref(<span class="string">&quot;articles&quot;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><ul>
<li><code>authorId = db.Column(db.Integer, db.ForeignKey(&quot;user.id&quot;))</code>：<ul>
<li>给 <code>Article</code> 这个模型添加一个 <code>author</code> 属性，可以访问这篇文章的作者的数据，像访问普通模型一样</li>
<li><code>backref</code>：定义反向引用，可以通过 <code>User.articles</code> 这个模型访问这个模型缩写的所有文章</li>
</ul>
</li>
</ul>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><ul>
<li><p>添加数据（方法二）：</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">article = Article(title=<span class="string">&quot;aaa&quot;</span>, content=<span class="string">&quot;bbb&quot;</span>)</span><br><span class="line">article.author = User.query.<span class="built_in">filter</span>(User.<span class="built_in">id</span>==<span class="number">1</span>).first()</span><br><span class="line">db.session.add(article)</span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h2><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><img data-src="/2021/04/05/137/image-20210423111049125.png" class="" title="image-20210423111049125">

<p>在这张图中：</p>
<img data-src="/2021/04/05/137/2.png" class="" width="2">

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ul>
<li><p>多对多的关系，要通过一个中间表进行关联；</p>
</li>
<li><p>中间表，不能通过 <code>class</code> 的方式实现，只能通过 <code>db.Table</code> 的方式实现</p>
</li>
<li><p>设置关联：</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tags = db.relationship(<span class="string">&quot;Tag&quot;</span>, secondary=articleTagRelation, backref=db.backref(<span class="string">&quot;articles&quot;</span>))</span><br></pre></td></tr></table></figure>

<p> 需要使用一个关键字参数 <code>secondary=中间表</code> 进行关联</p>
</li>
<li><p>访问和添加可以通过以下方式操作：</p>
<ul>
<li><p>添加数据</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">article1 = Article(title=<span class="string">&quot;aaa&quot;</span>)</span><br><span class="line">article2 = Article(title=<span class="string">&quot;bbb&quot;</span>)</span><br><span class="line">tag1 = Tag(name=<span class="string">&quot;111&quot;</span>)</span><br><span class="line">tag2 = Tag(name=<span class="string">&quot;222&quot;</span>)</span><br><span class="line"></span><br><span class="line">article1.tags.append(tag1)</span><br><span class="line">article1.tags.append(tag2)</span><br><span class="line"></span><br><span class="line">article2.tags.append(tag1)</span><br><span class="line">article2.tags.append(tag2)</span><br><span class="line"></span><br><span class="line">db.session.add(article1)</span><br><span class="line">db.session.add(article2)</span><br><span class="line">db.session.add(tag1)</span><br><span class="line">db.session.add(tag2)</span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问数据</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">article1 = Article.query.<span class="built_in">filter</span>(Article.title==<span class="string">&quot;aaa&quot;</span>).first()</span><br><span class="line">tags = article1.tags</span><br><span class="line"><span class="keyword">for</span> tag <span class="keyword">in</span> tags:</span><br><span class="line">    <span class="built_in">print</span>(tag.name)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h1 id="Flask-Script的介绍和安装"><a href="#Flask-Script的介绍和安装" class="headerlink" title="Flask-Script的介绍和安装"></a>Flask-Script的介绍和安装</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><code>Flask-Script</code> 的作用是可以通过命令行的形式来操作 <code>Flask</code>。例如通过命令跑一个开发版本的服务器、设置数据库、定时任务。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ol>
<li>进入到虚拟环境中</li>
<li><code>pip install flask-script</code>进行安装</li>
</ol>
<h2 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h2><ol>
<li><p>如果直接在主 <code>manage.py</code> 中写命令，那么在终端就只需要 <code>python manage.py commandName</code> 就可以了。</p>
</li>
<li><p>如果把一些命令集中在一个文件中，那么在终端就需要输入一个父命令，如 <code>python manage.py db init</code></p>
</li>
<li><p>例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_script <span class="keyword">import</span> Manager</span><br><span class="line"><span class="keyword">from</span> flaskScriptDemo <span class="keyword">import</span> app</span><br><span class="line"><span class="keyword">from</span> dbScript <span class="keyword">import</span> dbManager</span><br><span class="line"></span><br><span class="line">manager = Manager(app)</span><br><span class="line"></span><br><span class="line"><span class="meta">@manager.command</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">runserver</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;服务器跑起来了&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># params: 前缀（类似于别名），dbManager</span></span><br><span class="line"><span class="comment"># 使用：python manage.py db init</span></span><br><span class="line">manager.add_command(<span class="string">&quot;db&quot;</span>, dbManager)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    manager.run()</span><br></pre></td></tr></table></figure>
</li>
<li><p>有子命令的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_script <span class="keyword">import</span> Manager</span><br><span class="line"></span><br><span class="line">dbManager = Manager()</span><br><span class="line"></span><br><span class="line"><span class="meta">@dbManager.command</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据库初始化完成&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@dbManager.command</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">migrate</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据表迁移成功&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="分开-models-及解决循环引用"><a href="#分开-models-及解决循环引用" class="headerlink" title="分开 models 及解决循环引用"></a>分开 <code>models</code> 及解决循环引用</h1><h2 id="循环引用"><a href="#循环引用" class="headerlink" title="循环引用"></a>循环引用</h2><img data-src="/2021/04/05/137/image-20210423164012252.png" class="" title="image-20210423164012252">

<h3 id="解决办法："><a href="#解决办法：" class="headerlink" title="解决办法："></a>解决办法：</h3><img data-src="/2021/04/05/137/image-20210423164434699.png" class="" title="image-20210423164434699">

<blockquote>
<p>把 <code>db</code> 放在一个单独的文件中，切断循环引用的线条就可以了。</p>
</blockquote>
<h2 id="分开-models"><a href="#分开-models" class="headerlink" title="分开 models"></a>分开 <code>models</code></h2><ul>
<li>目的：为了让代码更加方便的管理</li>
</ul>
<h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h3><ul>
<li><p>使用了 <code>db.init_app(app)</code>，就不能直接使用 <code>db.create_all()</code>了，会报错。</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(__name__)</span><br><span class="line">app.config.from_object(modelSepConfig)</span><br><span class="line">db.init_app(app)</span><br></pre></td></tr></table></figure>

<p> 因为涉及到了上下文的问题：</p>
 <img data-src="/2021/04/05/137/image-20210423172011235.png" class="" title="image-20210423172011235">

<p> 解决办法看 <code>flask-migrate</code></p>
</li>
</ul>
<h1 id="flask-migrate"><a href="#flask-migrate" class="headerlink" title="flask-migrate"></a>flask-migrate</h1><h2 id="db-init-app-app-不能直接使用-db-create-all-解决办法"><a href="#db-init-app-app-不能直接使用-db-create-all-解决办法" class="headerlink" title="db.init_app(app)不能直接使用 db.create_all() 解决办法"></a><code>db.init_app(app)</code>不能直接使用 <code>db.create_all()</code> 解决办法</h2><blockquote>
<p>手动推动 <code>app</code> 到 <code>app栈</code> 中</p>
</blockquote>
<h2 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h2><p>因为采用 <code>db.create_all()</code> 在后期修改字段的时候，不会自动的映射到数据库中，必须删除表，然后重新运行 <code>db.create_all()</code> 才会重新映射，这样不符合我们的需求。因此 <code>flask-migrate</code> 就是为了解决这个问题，它可以在每次修改模型后，可将修改的东西映射到数据库中</p>
<h2 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h2><ol>
<li>进入虚拟环境</li>
<li><code>pip install flask-migrate</code></li>
</ol>
<h2 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h2><p>使用 <code>flask_migrate</code> 必须借助 <code>flask-scripts</code>，这个包的 <code>MigrateCommand</code> 中包含了所有和数据库相关的命令。</p>
<h3 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a>相关命令</h3><ul>
<li><code>python manage.py db init</code>: 初始化一个迁移脚本的环境，只需要执行一次；</li>
<li><code>python manage.py db migrate</code>: 将模型生成迁移文件，只要模型更改了，就需要执行一遍这个命令；</li>
<li><code>python manage.py db upgrade</code>: 将掐你文件真正映射到数据库中，每次运行了 <code>migrate</code> 命令后，就记得要运行这个命令</li>
</ul>
<h3 id="注意点-1"><a href="#注意点-1" class="headerlink" title="注意点"></a>注意点</h3><ul>
<li>如果需要将你想要映射到数据库中的模型，都要导入到 <code>manage.py</code> 文件中，如果没有导入进去，就不会映射到数据库中</li>
</ul>
<h3 id="manage-py-的相关代码"><a href="#manage-py-的相关代码" class="headerlink" title="manage.py 的相关代码"></a><code>manage.py</code> 的相关代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_script <span class="keyword">import</span> Manager</span><br><span class="line"><span class="keyword">from</span> migrateDemo <span class="keyword">import</span> app</span><br><span class="line"><span class="keyword">from</span> flask_migrate <span class="keyword">import</span> Migrate, MigrateCommand</span><br><span class="line"><span class="keyword">from</span> exts <span class="keyword">import</span> db</span><br><span class="line"><span class="keyword">from</span> models <span class="keyword">import</span> Article</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型 =&gt; 迁移文件 =&gt; 表</span></span><br><span class="line"><span class="comment"># init: 初始化迁移的环境</span></span><br><span class="line"><span class="comment"># migrate: 将模型生成迁移文件</span></span><br><span class="line"><span class="comment"># upgrade: 将迁移文件映射成表</span></span><br><span class="line"></span><br><span class="line">manager = Manager(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 要使用 flask_migrate，必须绑定app和db</span></span><br><span class="line">migrate = Migrate(app, db)</span><br><span class="line"><span class="comment"># 2. 把MigrateCommand命令添加到manager中</span></span><br><span class="line">manager.add_command(<span class="string">&quot;db&quot;</span>, MigrateCommand)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    manager.run()</span><br></pre></td></tr></table></figure>

<h1 id="cookie和session"><a href="#cookie和session" class="headerlink" title="cookie和session"></a>cookie和session</h1><h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><ul>
<li><p>出现的原因：在网站中，<code>http</code> 请求是无状态的。也就是说即使第一次和服务器连接后并且登录成功后，第二次请求服务器依然不知道当前请求是哪个用户。<code>cookie</code>的出现就是我了解决这个问题，第一次登录后服务器返回一些数据（<code>cookie</code>）给浏览器，然后浏览器保存在本地，当该用户发送第二次请求的时候，就会自动的把上次请求存储的 <code>cookie</code> 数据自动的携带给服务器，服务器通过浏览器携带的数据就能判断当前用户是那个了；</p>
</li>
<li><p>图解：</p>
 <img data-src="/2021/04/05/137/image-20210424090542356.png" class="" title="image-20210424090542356">
</li>
<li><p>如果服务器返回了 <code>cookie</code> 给浏览器，那么浏览器下次再请求相同的服务器的时候，就会自动的把 <code>cookie</code> 发送给服务器，这个过程，用户根本不需要管；</p>
</li>
<li><p><code>cookie</code> 是保存在浏览器中的，相对对的是浏览器；</p>
</li>
</ul>
<h2 id="session"><a href="#session" class="headerlink" title="session"></a>session</h2><ul>
<li><p>介绍：<code>session</code> 和 <code>cookie</code> 的作用有点类似，都是为了存储用户相关的信息。不同的是，<code>cookie</code> 是存储在本地服务器的，而 <code>session</code> 存储在服务器。存储在服务器的数据会更加安全，不容易被窃取。但存储在服务器也有一定的弊端，就是会占用服务器的资源，但现在服务器已经发展至今，一些 <code>session</code> 信息还是绰绰有余的。</p>
</li>
<li><p>图解：</p>
 <img data-src="/2021/04/05/137/image-20210424091536079.png" class="" title="image-20210424091536079">
</li>
<li><p>使用 <code>session</code> 的好处：</p>
<ul>
<li>敏感数据不是直接发送给服务器，而是发送回一个 <code>session_id</code> ，服务器将 <code>session_id</code> 和敏感数据做一个映射存储在 <code>session</code> (服务器上面)中，更加安全；</li>
<li><code>session</code> 可以设置过期时间，也可以从另外一方面，保证用户的账号安全。</li>
</ul>
</li>
</ul>
<h3 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h3><ul>
<li><code>session_id</code>：返回给浏览器的时候，是放在 <code>cookie</code> 中的。</li>
</ul>
<h2 id="flask中session工作机制"><a href="#flask中session工作机制" class="headerlink" title="flask中session工作机制"></a>flask中session工作机制</h2><ul>
<li><p>讲解：把敏感数据经过加密后放入 <code>session</code> 中，然后再把 <code>session</code> 存放到 <code>cookie</code> 中，下次请求的时候，再从浏览器发送过来的 <code>cookie</code> 中读取 <code>session</code>，然后再从 <code>session</code> 中读取敏感数据，并进行解密，获取最终的用户数据；</p>
</li>
<li><p><code>flask</code> 的这种 <code>session</code> 机制，可以节省服务器的开销，以内把所有的信息都存储到了客户端（浏览器）；</p>
</li>
<li><p>安全是相对的，没有绝对的安全，把 <code>session</code> 放到 <code>cookie</code> 中，经过机密，也是比较安全的；</p>
</li>
<li><p>图解：</p>
 <img data-src="/2021/04/05/137/image-20210424093103556.png" class="" title="image-20210424093103556"></li>
</ul>
<h2 id="flask操作session"><a href="#flask操作session" class="headerlink" title="flask操作session"></a>flask操作session</h2><h3 id="session的操作方式："><a href="#session的操作方式：" class="headerlink" title="session的操作方式："></a>session的操作方式：</h3><ul>
<li>使用 <code>session</code> 需要从 <code>flask</code> 中导入 <code>session</code>，以后所有和 <code>session</code> 相关的操作都是通过这个变量来的；</li>
<li>使用 <code>session</code> 需要设置 <code>SECRET_KEY</code>，用来作为加密用的。并且这个 <code>SECRET_KEY</code> 如果每次服务器启动后都变化的话，那么之前的 <code>session</code> 就不能通过当前这个 <code>SECRET_KEY</code> 进行解密了；</li>
<li>操作 <code>session</code> ，跟操作字典是一样的；</li>
<li>添加 <code>session</code>：<code>session[key]=value</code></li>
<li>删除：<code>session.pop(key)</code> 或者 <code>del session[key]</code></li>
<li>清除所有 <code>session</code>：<code>session.clear()</code></li>
<li>获取 <code>session</code>：<code>session.get(key)</code></li>
</ul>
<h3 id="设置session的过期时间"><a href="#设置session的过期时间" class="headerlink" title="设置session的过期时间"></a>设置session的过期时间</h3><ul>
<li><p>如果没有指定<code>session</code>的过期时间，那么默认是浏览器关闭后就自动结束</p>
</li>
<li><p>如果设置了 <code>session</code> 的 <code>permanent</code> 属性为 <code>True</code>，那么过期时间是31天</p>
</li>
<li><p>可以通过给 <code>app.config</code> 设置 <code>PERMANENT_SESSION_LIFETIME</code> 来更改过期时间，这个值的数据类型是 <code>datatime.timedelay</code> 类型：</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"></span><br><span class="line">PERMANENT_SESSION_LIFETIME = timedelta(days=<span class="number">7</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="get请求和post请求"><a href="#get请求和post请求" class="headerlink" title="get请求和post请求"></a>get请求和post请求</h1><h2 id="get请求"><a href="#get请求" class="headerlink" title="get请求"></a>get请求</h2><ul>
<li>使用场景：如果只对服务器获取数据，并没有对服务器产生任何影响，那么这时候使用 <code>get</code> 请求</li>
<li>传参：<code>get</code>请求传参是防砸<code>url</code>中，并且是通过 <code>?</code>的形式来指定 <code>key</code> 和 <code>value</code> 的</li>
</ul>
<h2 id="post请求"><a href="#post请求" class="headerlink" title="post请求"></a>post请求</h2><ul>
<li>使用场景：如果要对服务器产生影响，那么使用post请求，如： 登录：服务器要记录用户什么时候登陆过，要把数据保存在本地；</li>
<li>传参：post请求传参不是放在 <code>url</code> 中，而是通过 <code>form data</code> 的形式发送给服务器的</li>
</ul>
<h2 id="获取参数"><a href="#获取参数" class="headerlink" title="获取参数"></a>获取参数</h2><ul>
<li><code>get</code>请求：通过 <code>flask.request.args</code> 来获取</li>
<li><code>post</code>请求：通过 <code>flask.request.form</code> 来获取</li>
</ul>
<h3 id="注意-2"><a href="#注意-2" class="headerlink" title="注意"></a>注意</h3><ul>
<li><p><code>post</code>请求在模板中要注意几点：</p>
<ul>
<li><p><code>input</code>标签中，要写<code>name</code>来标识这个 <code>value</code> 的 <code>key</code>，方便后台获取</p>
</li>
<li><p>在写 <code>form</code> 表单的时候，要指定 <code>method=&#39;post&#39;</code>，并且要指定 <code>action=&#39;/login/&#39;</code></p>
</li>
<li><p>示例代码</p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&#123;&#123; url_for(&quot;</span><span class="attr">login</span>&quot;) &#125;&#125;&quot; <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入用户名&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入密码&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;登录&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h1 id="保存全局遍历的g属性"><a href="#保存全局遍历的g属性" class="headerlink" title="保存全局遍历的g属性"></a>保存全局遍历的g属性</h1><p><code>g</code>: <code>global</code></p>
<ul>
<li><code>g对象</code> 是专门用来保存用户的数据的</li>
<li><code>g对象</code> 在一次请求中的所有的代码的地方，都是可以使用的</li>
</ul>
<h1 id="钩子函数-hook"><a href="#钩子函数-hook" class="headerlink" title="钩子函数(hook)"></a>钩子函数(hook)</h1><h2 id="钩子函数"><a href="#钩子函数" class="headerlink" title="钩子函数"></a>钩子函数</h2><img data-src="/2021/04/05/137/image-20210424211318851.png" class="" title="image-20210424211318851">

<p>正常执行情况：先执行A，然后再执行B。</p>
<p>钩子函数：可以在运行时，把C直接插入到AB之间</p>
<h2 id="before-request"><a href="#before-request" class="headerlink" title="before_request"></a><code>before_request</code></h2><ul>
<li><code>before_request</code>:在请求之前执行的函数，且每次请求都会执行一遍</li>
<li><code>before_request</code>是在视图函数执行之前执行的</li>
<li><code>before_request</code>这个函数只是一个装饰器，他可以把需要设置为钩子函数的代码放到视图函数执行之前来执行</li>
</ul>
<h2 id="context-processor（上下文处理器）"><a href="#context-processor（上下文处理器）" class="headerlink" title="context_processor（上下文处理器）"></a><code>context_processor</code>（上下文处理器）</h2><ul>
<li>出现的原因：多个不同的页面需要相同的参数，如：<code>username</code></li>
<li>上下文处理器应该返回一个字典，字典中的 <code>key</code> 会被模板当成变量来渲染</li>
<li>上下文处理器中返回的字典，在所有页面中都是可用的。</li>
<li>被这个装饰器修饰的钩子函数，必须要返回一个字典，即使为空，也要返回</li>
</ul>
<h1 id="装饰器-1"><a href="#装饰器-1" class="headerlink" title="装饰器"></a>装饰器</h1><ul>
<li><p>需求1：在打印<code>run</code>之前，先要打印<code>hello world</code></p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;run&quot;</span>)</span><br><span class="line">    </span><br><span class="line">run()</span><br></pre></td></tr></table></figure>
</li>
<li><p>需求2：在所有函数执行之前，都要打印一个 <code>hello world</code></p>
<ul>
<li><p>方法一：</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;run&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;run1&quot;</span>)</span><br><span class="line"></span><br><span class="line">run()</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二（如果成千上万个函数，比较麻烦，且难以维护）：装饰器</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 装饰器的两个特别之处：</span></span><br><span class="line"><span class="comment"># 1. 参数是一个函数</span></span><br><span class="line"><span class="comment"># 2. 返回值是一个函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myLog</span>(<span class="params">func</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">        func()</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    补充：</span></span><br><span class="line"><span class="string">        wrapper: 函数体</span></span><br><span class="line"><span class="string">        wrapper(): 执行wrapper这个函数</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如何用</span></span><br><span class="line"><span class="meta">@myLog</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;run&quot;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">等价于上面</span></span><br><span class="line"><span class="string">run = myLog(run) &lt;==&gt; wrapper</span></span><br><span class="line"><span class="string">run() &lt;==&gt; wrapper() &lt;==&gt; print(&quot;hello world&quot;); func() &lt;==&gt; print(&quot;hello world&quot;); print(&quot;run&quot;)</span></span><br><span class="line"><span class="string">理解：func() 执行的才是真的 run() 方法</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">run()</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="讲解"><a href="#讲解" class="headerlink" title="讲解"></a>讲解</h2><ul>
<li>装饰器的两个特别之处：<ul>
<li>参数是一个函数</li>
<li>返回值是一个函数</li>
</ul>
</li>
<li>上面的 <code>myLog()</code> 是无参情况下的装饰器</li>
</ul>
<h2 id="进阶：有参情况下的装饰器"><a href="#进阶：有参情况下的装饰器" class="headerlink" title="进阶：有参情况下的装饰器"></a>进阶：有参情况下的装饰器</h2><p>需求：在所有函数执行之前，都要打印一个 <code>hello world</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 装饰器的两个特别之处：</span><br><span class="line"># 1. 参数是一个函数</span><br><span class="line"># 2. 返回值是一个函数</span><br><span class="line">def myLog(func):</span><br><span class="line"></span><br><span class="line">    def wrapper(a, b):</span><br><span class="line">        print(&quot;hello world&quot;)</span><br><span class="line">        func(a, b)</span><br><span class="line">    return wrapper</span><br><span class="line"></span><br><span class="line">@myLog</span><br><span class="line">def add(a, b):</span><br><span class="line">    print(&quot;结果是&quot;, a + b)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">等价于上面</span><br><span class="line">add = myLog(add) &lt;==&gt; wrapper</span><br><span class="line">add(1, 2) &lt;==&gt; wrapper(1, 2) # 因此，如果wrapper()无参，就会报错 `TypeError: wrapper() takes 0 positional arguments but 2 were given`</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">add(1, 2)</span><br></pre></td></tr></table></figure>

<h2 id="再进阶：有无参同时存在情况下的装饰器"><a href="#再进阶：有无参同时存在情况下的装饰器" class="headerlink" title="再进阶：有无参同时存在情况下的装饰器"></a>再进阶：有无参同时存在情况下的装饰器</h2><ul>
<li><p>解决办法： <code>*args, **kwargs</code>：可以表示任何参数</p>
<ul>
<li><code>*args</code>： 位置参数，如：<code>add(a, b)</code> 中的<code>ab</code>，参数是一一对应的</li>
<li><code>**kwargs</code>：关键字参数（<code>key=value</code>），如：<code>add(a=abc)</code>的<code>a</code>就是传入的<code>abc</code></li>
</ul>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">myLog</span>(<span class="params">func</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">        func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>run()</code>, <code>add()</code> 同上</p>
</blockquote>
</li>
</ul>
<h2 id="再进阶"><a href="#再进阶" class="headerlink" title="再进阶"></a>再进阶</h2><ul>
<li><p>问题：加完装饰器后，函数名被偷偷更改掉了，因此如何保留住原来的函数的名字（把名字改掉是很危险的行为）？</p>
<ul>
<li><p>没有装饰器的情况</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;run&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(run.__name__) <span class="comment"># run.__name__代表的是run这个函数的名称</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>输出：</p>
<p><code>run</code></p>
</blockquote>
</li>
<li><p>有装饰器的情况</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@myLog</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;run&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(run.__name__)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>输出：</p>
<p><code>wrapper</code></p>
</blockquote>
</li>
</ul>
</li>
<li><p>解决办法：</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myLog</span>(<span class="params">func</span>):</span><br><span class="line"></span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">        func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>
<ul>
<li><p>没加 <code>@wraps</code> 的情况<br> <code>run() &lt;=&gt; myLog(run)() &lt;=&gt; wrapper()</code>  </p>
</li>
<li><p>加了 <code>@wraps(func) </code>的情况</p>
<ul>
<li><code>run &lt;=&gt; myLog(run) &lt;=&gt; @wraps(func)装饰的wrapper &lt;=&gt; wraps(wrapper) &lt;=&gt; wrapsFunction（这个函数是透明的，即看不到的，但是不管怎么样，返回的函数的__name__是run） =&gt; wrapsFunction.__name__ == &quot;run&quot;</code></li>
<li>&#96;&#96;run() &lt;&#x3D;&gt; myLog(run)() &lt;&#x3D;&gt; @wraps装饰的wrapper() &lt;&#x3D;&gt; wraps(wrapper)() &lt;&#x3D;&gt; wrapsFunction()&#96;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="再进阶-1"><a href="#再进阶-1" class="headerlink" title="再进阶"></a>再进阶</h2><ul>
<li><p>需求：如果<code>run()</code>有返回值，该怎么办?</p>
</li>
<li><p>解决办法：在 <code>wrapper()</code> 中 <code>return func(*args, **kwargs)</code></p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myLog</span>(<span class="params">func</span>):</span><br><span class="line"></span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line">    </span><br><span class="line"><span class="meta">@myLog</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>+<span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>讲解：</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">run = myLog(run) = wrapper</span><br><span class="line">==&gt;（推出，下同） run = wrapper</span><br><span class="line">==&gt; run() = wrapper() = print(&quot;hello world&quot;); return run() = print(&quot;hello world&quot;); return 1+1</span><br><span class="line">因为run()需要返回1+1，所以wrapper()也需要返回1+1</span><br><span class="line">如果wrapper没有return，那么func(*args, **kwargs)，就只是执行了一下1+1，别的什么都没有了</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><ul>
<li>装饰器的使用是通过 <code>@</code> 符号，放在函数上面；</li>
<li>装饰器中定义的函数，要使用 <code>*args</code> 和 <code>**kwargs</code> 两对兄弟的组合，并且在这个函数中执行原始函数的时候也要把 <code>*args</code> 和 <code>**kwargs</code> 传进去；</li>
<li>需要使用 <code>functools.wraps</code> 在装饰器中的函数上把传进来的这个函数进行一个包裹，这样就不会丢失原来的函数 <code>__name__</code> 等属性</li>
</ul>
<h1 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h1><ul>
<li>框架：<code>bootstrap</code>，<a target="_blank" rel="noopener" href="https://www.bootcss.com/">中文网</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Qeuroal
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://qeuroal.top/2021/04/05/137/" title="137. Flask">http://qeuroal.top/2021/04/05/137/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/python/" rel="tag"><i class="fa fa-tag"></i> python</a>
              <a href="/tags/flask/" rel="tag"><i class="fa fa-tag"></i> flask</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/04/04/136/" rel="prev" title="136. Vim的QAs">
                  <i class="fa fa-angle-left"></i> 136. Vim的QAs
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/04/28/138/" rel="next" title="138. VIM's World">
                  138. VIM's World <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Qeuroal</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/Qeuroal" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.24/fancybox/fancybox.umd.js" integrity="sha256-oyhjPiYRWGXaAt+ny/mTMWOnN1GBoZDUQnzzgC7FRI4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
