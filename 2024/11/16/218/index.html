<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/avatar.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.24/fancybox/fancybox.css" integrity="sha256-vQkngPS8jiHHH0I6ABTZroZk8NPZ7b+MUReOFE9UsXQ=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"qeuroal.top","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="详细">
<meta property="og:type" content="article">
<meta property="og:title" content="218. lua">
<meta property="og:url" content="http://qeuroal.top/2024/11/16/218/index.html">
<meta property="og:site_name" content="Qeuroal&#39;s Blog">
<meta property="og:description" content="详细">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-11-15T16:00:00.000Z">
<meta property="article:modified_time" content="2025-10-01T23:18:39.604Z">
<meta property="article:author" content="Qeuroal">
<meta property="article:tag" content="lua">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://qeuroal.top/2024/11/16/218/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://qeuroal.top/2024/11/16/218/","path":"2024/11/16/218/","title":"218. lua"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>218. lua | Qeuroal's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Qeuroal's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">静幽正治</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Lua%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97"><span class="nav-number">1.</span> <span class="nav-text">Lua语言入门指南</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-Lua-%E7%8E%AF%E5%A2%83"><span class="nav-number">1.1.</span> <span class="nav-text">安装 Lua 环境</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85"><span class="nav-number">1.1.1.</span> <span class="nav-text">Linux 环境安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mac-OS-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85"><span class="nav-number">1.1.2.</span> <span class="nav-text">Mac OS 环境安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AALua%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.2.</span> <span class="nav-text">第一个Lua程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%A4%E4%BA%92%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="nav-number">1.2.1.</span> <span class="nav-text">交互式编程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="nav-number">1.2.2.</span> <span class="nav-text">脚本式编程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E7%9A%84%E6%B3%A8%E9%87%8A"><span class="nav-number">1.3.</span> <span class="nav-text">Lua 的注释</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E8%A1%8C%E6%B3%A8%E9%87%8A"><span class="nav-number">1.3.1.</span> <span class="nav-text">单行注释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E8%A1%8C%E6%B3%A8%E9%87%8A"><span class="nav-number">1.3.2.</span> <span class="nav-text">多行注释</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%87%E7%A4%BA%E7%AC%A6"><span class="nav-number">1.4.</span> <span class="nav-text">标示符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-number">1.5.</span> <span class="nav-text">Lua 关键字</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="nav-number">1.6.</span> <span class="nav-text">全局变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.7.</span> <span class="nav-text">Lua 数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8type-%E5%87%BD%E6%95%B0%E6%B5%8B%E8%AF%95%E7%BB%99%E5%AE%9A%E5%8F%98%E9%87%8F%E6%88%96%E5%80%BC%E5%BE%97%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.7.1.</span> <span class="nav-text">使用type()函数测试给定变量或值得数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nil-%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.7.2.</span> <span class="nav-text">nil 类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#boolean-%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.7.3.</span> <span class="nav-text">boolean 类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#number-%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.7.4.</span> <span class="nav-text">number 类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#string-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">1.7.5.</span> <span class="nav-text">string 字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#table-%E8%A1%A8"><span class="nav-number">1.7.6.</span> <span class="nav-text">table 表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#function-%E5%87%BD%E6%95%B0"><span class="nav-number">1.7.7.</span> <span class="nav-text">function 函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#thread-%E7%BA%BF%E7%A8%8B"><span class="nav-number">1.7.8.</span> <span class="nav-text">thread 线程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E5%8F%98%E9%87%8F"><span class="nav-number">1.8.</span> <span class="nav-text">Lua 变量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B5%8B%E5%80%BC%E8%AF%AD%E5%8F%A5"><span class="nav-number">1.8.1.</span> <span class="nav-text">赋值语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95"><span class="nav-number">1.8.2.</span> <span class="nav-text">索引</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lua-%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B%E6%8C%87%E5%8D%97"><span class="nav-number">2.</span> <span class="nav-text">Lua 语言编程指南</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E5%BE%AA%E7%8E%AF"><span class="nav-number">2.1.</span> <span class="nav-text">Lua 循环</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#while-%E5%BE%AA%E7%8E%AF"><span class="nav-number">2.1.1.</span> <span class="nav-text">while 循环</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#for-%E5%BE%AA%E7%8E%AF"><span class="nav-number">2.1.2.</span> <span class="nav-text">for 循环</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E5%80%BCfor%E5%BE%AA%E7%8E%AF"><span class="nav-number">2.1.2.1.</span> <span class="nav-text">数值for循环</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%9B%E5%9E%8Bfor%E5%BE%AA%E7%8E%AF"><span class="nav-number">2.1.2.2.</span> <span class="nav-text">泛型for循环</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#repeat%E2%80%A6until-%E5%BE%AA%E7%8E%AF"><span class="nav-number">2.1.3.</span> <span class="nav-text">repeat…until 循环</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.2.</span> <span class="nav-text">Lua 流程控制语句</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#if-%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.2.1.</span> <span class="nav-text">if 语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#if%E2%80%A6else-%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.2.2.</span> <span class="nav-text">if…else 语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#if%E2%80%A6elseif%E2%80%A6else-%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.2.3.</span> <span class="nav-text">if…elseif…else 语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#if%E5%B5%8C%E5%A5%97%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.2.4.</span> <span class="nav-text">if嵌套语句</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E5%87%BD%E6%95%B0"><span class="nav-number">2.3.</span> <span class="nav-text">Lua 函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E8%BF%94%E5%9B%9E%E5%80%BC%E5%87%BD%E6%95%B0"><span class="nav-number">2.3.1.</span> <span class="nav-text">多返回值函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0"><span class="nav-number">2.3.2.</span> <span class="nav-text">可变参数函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.4.</span> <span class="nav-text">Lua 运算符</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.4.1.</span> <span class="nav-text">算术运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E7%B3%BB%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.4.2.</span> <span class="nav-text">关系运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.4.3.</span> <span class="nav-text">逻辑运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.4.4.</span> <span class="nav-text">其他运算符</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">2.5.</span> <span class="nav-text">Lua 字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0"><span class="nav-number">2.5.1.</span> <span class="nav-text">字符串操作函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Luau%E6%95%B0%E7%BB%84"><span class="nav-number">2.6.</span> <span class="nav-text">Luau数组</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E7%BB%B4%E6%95%B0%E7%BB%84"><span class="nav-number">2.6.1.</span> <span class="nav-text">一维数组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%84"><span class="nav-number">2.6.2.</span> <span class="nav-text">多维数组</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="nav-number">2.7.</span> <span class="nav-text">迭代器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%9B%E5%9E%8B-for-%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="nav-number">2.7.1.</span> <span class="nav-text">泛型 for 迭代器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E7%8A%B6%E6%80%81%E7%9A%84%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="nav-number">2.7.2.</span> <span class="nav-text">无状态的迭代器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E7%8A%B6%E6%80%81%E7%9A%84%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="nav-number">2.7.3.</span> <span class="nav-text">多状态的迭代器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E8%A1%A8-Tbale"><span class="nav-number">2.8.</span> <span class="nav-text">Lua 表 Tbale</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#table-%E7%9A%84%E6%9E%84%E9%80%A0"><span class="nav-number">2.8.1.</span> <span class="nav-text">table 的构造</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E6%A8%A1%E5%9D%97%E4%B8%8E%E5%8C%85"><span class="nav-number">2.9.</span> <span class="nav-text">Lua 模块与包</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E5%BC%95%E5%85%A5%E5%87%BD%E6%95%B0-require"><span class="nav-number">2.9.1.</span> <span class="nav-text">模块引入函数 require</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6"><span class="nav-number">2.9.2.</span> <span class="nav-text">加载机制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E5%85%83%E8%A1%A8"><span class="nav-number">2.10.</span> <span class="nav-text">Lua 元表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#index-%E5%85%83%E6%96%B9%E6%B3%95"><span class="nav-number">2.10.1.</span> <span class="nav-text">__index 元方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#index-%E5%8C%85%E5%90%AB%E8%A1%A8table%E7%A4%BA%E4%BE%8B"><span class="nav-number">2.10.1.1.</span> <span class="nav-text">__index 包含表table示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#index-%E5%8C%85%E5%90%AB%E5%87%BD%E6%95%B0%E7%A4%BA%E4%BE%8B"><span class="nav-number">2.10.1.2.</span> <span class="nav-text">__index 包含函数示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#newindex-%E5%85%83%E6%96%B9%E6%B3%95"><span class="nav-number">2.10.2.</span> <span class="nav-text">__newindex 元方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%99%E8%A1%A8%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="nav-number">2.10.3.</span> <span class="nav-text">给表添加操作符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#call-%E5%85%83%E6%96%B9%E6%B3%95"><span class="nav-number">2.10.4.</span> <span class="nav-text">__call 元方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tostring-%E5%85%83%E6%96%B9%E6%B3%95"><span class="nav-number">2.10.5.</span> <span class="nav-text">__tostring 元方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lua-%E7%BC%96%E7%A8%8B%E9%AB%98%E7%BA%A7"><span class="nav-number">3.</span> <span class="nav-text">Lua 编程高级</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E5%8D%8F%E5%90%8C%E7%A8%8B%E5%BA%8F-coroutine"><span class="nav-number">3.1.</span> <span class="nav-text">Lua 协同程序(coroutine)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%8D%8F%E5%90%8C-coroutine"><span class="nav-number">3.1.1.</span> <span class="nav-text">什么是协同(coroutine)?</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%8D%8F%E5%90%8C%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">3.1.1.1.</span> <span class="nav-text">线程和协同程序的区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95"><span class="nav-number">3.1.1.2.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-number">3.1.1.3.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85-%E6%B6%88%E8%B4%B9%E8%80%85%E9%97%AE%E9%A2%98"><span class="nav-number">3.1.2.</span> <span class="nav-text">生产者-消费者问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E6%96%87%E4%BB%B6-IO"><span class="nav-number">3.2.</span> <span class="nav-text">Lua 文件 IO</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.2.1.</span> <span class="nav-text">简单模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E5%85%A8%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.2.2.</span> <span class="nav-text">完全模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6"><span class="nav-number">3.3.</span> <span class="nav-text">Lua 错误处理机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%E9%94%99%E8%AF%AF"><span class="nav-number">3.3.1.</span> <span class="nav-text">语法错误</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E9%94%99%E8%AF%AF"><span class="nav-number">3.3.2.</span> <span class="nav-text">运行错误</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">3.3.3.</span> <span class="nav-text">错误处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#error-%E5%87%BD%E6%95%B0"><span class="nav-number">3.3.4.</span> <span class="nav-text">error 函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pcall-%E5%92%8C-xpcall%E3%80%81debug"><span class="nav-number">3.3.5.</span> <span class="nav-text">pcall 和 xpcall、debug</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E8%B0%83%E8%AF%95"><span class="nav-number">3.4.</span> <span class="nav-text">Lua 调试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="nav-number">3.5.</span> <span class="nav-text">Lua 垃圾回收</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E5%87%BD%E6%95%B0"><span class="nav-number">3.5.1.</span> <span class="nav-text">垃圾回收器函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1"><span class="nav-number">3.6.</span> <span class="nav-text">Lua 面向对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Lua-%E4%B8%AD%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1"><span class="nav-number">3.6.1.</span> <span class="nav-text">Lua 中面向对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B"><span class="nav-number">3.6.1.1.</span> <span class="nav-text">一个简单示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1"><span class="nav-number">3.6.1.2.</span> <span class="nav-text">创建对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E5%B1%9E%E6%80%A7"><span class="nav-number">3.6.1.3.</span> <span class="nav-text">访问属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0"><span class="nav-number">3.6.1.4.</span> <span class="nav-text">访问成员函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Lua-%E7%BB%A7%E6%89%BF%E5%AE%9E%E4%BE%8B"><span class="nav-number">3.6.1.5.</span> <span class="nav-text">Lua 继承实例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E9%87%8D%E5%86%99"><span class="nav-number">3.6.1.6.</span> <span class="nav-text">函数重写</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE"><span class="nav-number">3.7.</span> <span class="nav-text">Lua 数据库访问</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Qeuroal"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Qeuroal</p>
  <div class="site-description" itemprop="description">大人者，不失其赤子之心</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">183</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Qeuroal" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Qeuroal" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://qeuroal.top/2024/11/16/218/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Qeuroal">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Qeuroal's Blog">
      <meta itemprop="description" content="大人者，不失其赤子之心">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="218. lua | Qeuroal's Blog">
      <meta itemprop="description" content="详细">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          218. lua
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-16 00:00:00" itemprop="dateCreated datePublished" datetime="2024-11-16T00:00:00+08:00">2024-11-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-10-02 07:18:39" itemprop="dateModified" datetime="2025-10-02T07:18:39+08:00">2025-10-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/lua/" itemprop="url" rel="index"><span itemprop="name">lua</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">详细</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="Lua语言入门指南"><a href="#Lua语言入门指南" class="headerlink" title="Lua语言入门指南"></a>Lua语言入门指南</h1><h2 id="安装-Lua-环境"><a href="#安装-Lua-环境" class="headerlink" title="安装 Lua 环境"></a>安装 Lua 环境</h2><h3 id="Linux-环境安装"><a href="#Linux-环境安装" class="headerlink" title="Linux 环境安装"></a>Linux 环境安装</h3><p>Linux &amp; Mac上安装 Lua 安装非常简单，只需要下载源码包并在终端解压编译即可，本文使用了5.3.0版本进行安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -R -O http://www.lua.org/ftp/lua-5.3.0.tar.gz</span><br><span class="line">tar zxf lua-5.3.0.tar.gz</span><br><span class="line">cd lua-5.3.0</span><br><span class="line">make linux test</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h3 id="Mac-OS-环境安装"><a href="#Mac-OS-环境安装" class="headerlink" title="Mac OS 环境安装"></a>Mac OS 环境安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -R -O http://www.lua.org/ftp/lua-5.3.0.tar.gz</span><br><span class="line">tar zxf lua-5.3.0.tar.gz</span><br><span class="line">cd lua-5.3.0</span><br><span class="line">make macosx test</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h2 id="第一个Lua程序"><a href="#第一个Lua程序" class="headerlink" title="第一个Lua程序"></a>第一个Lua程序</h2><p>在Cent OS 的 Linux环境下演示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;print(&quot;Hello,Lua!&quot;)&#x27; &gt; hello.lua</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行 lua hello.lua</span></span><br><span class="line">lua hello.lua</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出结果为：</span></span><br><span class="line">Hello,Lua!</span><br></pre></td></tr></table></figure>

<h3 id="交互式编程"><a href="#交互式编程" class="headerlink" title="交互式编程"></a>交互式编程</h3><p>Lua提供了交互式编程模式。我们可以在命令行中输入程序并立即查看效果。</p>
<p>Lua 交互式编程模式可以通过命令 <strong>lua -i</strong> 或者 <strong>lua</strong> 来启用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lua -i</span><br><span class="line">Lua 5.1.4  Copyright (C) 1994-2008 Lua.org, PUC-Rio</span><br><span class="line"><span class="meta prompt_">&gt; </span></span><br></pre></td></tr></table></figure>

<p>在命令行中输入如下命令</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">print</span>(<span class="string">&quot;Hello,Lua!&quot;</span>)</span><br><span class="line"></span><br><span class="line"># 输出结果为:</span><br><span class="line">Hello,Lua!</span><br></pre></td></tr></table></figure>

<h3 id="脚本式编程"><a href="#脚本式编程" class="headerlink" title="脚本式编程"></a>脚本式编程</h3><p>将lua脚本保存到 .lua 的文件中，再使用 lua 执行该脚本文件。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="string">&#x27;print(&quot;Nice to meet you!&quot;)&#x27;</span> &gt; nice.lua</span><br><span class="line">$ cat nice.lua </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Nice to meet you!&quot;</span>)</span><br><span class="line">$ lua nice.lua </span><br><span class="line">Nice to meet you!</span><br></pre></td></tr></table></figure>

<h2 id="Lua-的注释"><a href="#Lua-的注释" class="headerlink" title="Lua 的注释"></a>Lua 的注释</h2><h3 id="单行注释"><a href="#单行注释" class="headerlink" title="单行注释"></a>单行注释</h3><p>2个减号 <strong>–</strong> 用以表明是单行注释</p>
<h3 id="多行注释"><a href="#多行注释" class="headerlink" title="多行注释"></a>多行注释</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">        多行注释内容1</span></span><br><span class="line"><span class="comment">        多行注释内容2</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></table></figure>

<h2 id="标示符"><a href="#标示符" class="headerlink" title="标示符"></a>标示符</h2><p>Lua 标示符用于定义一个变量。<br>标示符以一个字母A 到 Z 或 a 到 z 或下划线 _开头后加上0个或多个字母，下划线，数字(0到9)。</p>
<p><strong>最好不用下划线加大写字母开头的标示符，因为Lua的保留字也是这样的形式。</strong></p>
<p>Lua 不允许使用特殊字符如 @，$，和 % 来定义标示符。<br>Lua区分大小写。</p>
<h2 id="Lua-关键字"><a href="#Lua-关键字" class="headerlink" title="Lua 关键字"></a>Lua 关键字</h2><p>Lua 关键字，不允许用户自定义为标示符。</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>and</td>
<td>break</td>
<td>do</td>
<td>else</td>
</tr>
<tr>
<td>elseif</td>
<td>end</td>
<td>false</td>
<td>for</td>
</tr>
<tr>
<td>function</td>
<td>if</td>
<td>in</td>
<td>local</td>
</tr>
<tr>
<td>nil</td>
<td>not</td>
<td>or</td>
<td>repeat</td>
</tr>
<tr>
<td>return</td>
<td>then</td>
<td>true</td>
<td>until</td>
</tr>
<tr>
<td>while</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>一般约定，以下划线开头连接遗传大写字母的名字（比如 <strong>_VERSION</strong>）是Lua内部全局变量的保留字。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">print</span>(<span class="built_in">_VERSION</span>)</span><br><span class="line">Lua <span class="number">5.1</span></span><br></pre></td></tr></table></figure>

<h2 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h2><p>默认情况下，变量总是认为全局的。<br>全局变量不需要声明，给一个变量赋值后即创建了这个全局变量，访问一个没有初始化的全局变量也不会出错，只不过得到的结果是空： nul。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">print</span>(a)</span><br><span class="line"><span class="literal">nil</span></span><br><span class="line">&gt; a = <span class="number">10</span></span><br><span class="line">&gt; <span class="built_in">print</span>(a)</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure>

<p><strong>如果想删除一个全局变量，将其赋值为nil即可。</strong></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; a = <span class="literal">nil</span></span><br><span class="line">&gt; <span class="built_in">print</span>(a)</span><br><span class="line"><span class="literal">nil</span></span><br></pre></td></tr></table></figure>


<h2 id="Lua-数据类型"><a href="#Lua-数据类型" class="headerlink" title="Lua 数据类型"></a>Lua 数据类型</h2><p>Lua 有8个基本类型：</p>
<table>
<thead>
<tr>
<th>数据类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td>nil</td>
<td align="center">是一个空值</td>
</tr>
<tr>
<td>boolea</td>
<td align="center">false、true</td>
</tr>
<tr>
<td>number</td>
<td align="center">表示双精度的浮点数</td>
</tr>
<tr>
<td>string</td>
<td align="center">字符串，由一堆双引号或者单引号包围</td>
</tr>
<tr>
<td>function</td>
<td align="center">由C或者Lua编写的函数</td>
</tr>
<tr>
<td>userdate</td>
<td align="center">表示任意存储在变量中的C数据结构</td>
</tr>
<tr>
<td>thread</td>
<td align="center">表示执行的独立线程，用于执行协同程序</td>
</tr>
<tr>
<td>table</td>
<td align="center">Lua中的表是一个关联数组，数组的索引可以是数字或者字符串。最简单的表是{}，表示是一个空表</td>
</tr>
</tbody></table>
<h3 id="使用type-函数测试给定变量或值得数据类型"><a href="#使用type-函数测试给定变量或值得数据类型" class="headerlink" title="使用type()函数测试给定变量或值得数据类型"></a>使用type()函数测试给定变量或值得数据类型</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">type</span>(<span class="string">&quot;Hello World!&quot;</span>)</span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="built_in">type</span>(<span class="string">&quot;Hello World!&quot;</span>))</span><br><span class="line"><span class="built_in">string</span></span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="built_in">type</span>(<span class="string">&quot;10.4*3&quot;</span>))</span><br><span class="line"><span class="built_in">string</span></span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">10.4</span>*<span class="number">3</span>))</span><br><span class="line">number</span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="built_in">type</span>(<span class="built_in">print</span>))</span><br><span class="line"><span class="function"><span class="keyword">function</span></span></span><br><span class="line"><span class="function">&gt; <span class="title">print</span><span class="params">(type(type)</span></span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span></span></span><br><span class="line"><span class="function">&gt; <span class="title">print</span><span class="params">(type(true)</span></span>)</span><br><span class="line">boolean</span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="built_in">type</span>(<span class="literal">nil</span>))</span><br><span class="line"><span class="literal">nil</span></span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="built_in">type</span>(<span class="built_in">type</span>(x)))</span><br><span class="line"><span class="built_in">string</span></span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="built_in">type</span>(x))</span><br><span class="line"><span class="literal">nil</span></span><br></pre></td></tr></table></figure>

<h3 id="nil-类型"><a href="#nil-类型" class="headerlink" title="nil 类型"></a>nil 类型</h3><p>nil 表示是一个无效的值。例如输出一个没有赋值的全局变量，便会得到一个 nil 值。<br>对于全局变量、table， nil 还有一个作用，给全局变量或者table表里的变量赋值为nil时，等同于把他们删掉。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; tab1 = &#123; key1 = <span class="string">&quot;val1&quot;</span>, key2 = <span class="string">&quot;val2&quot;</span>, <span class="string">&quot;val3&quot;</span> &#125; <span class="comment">-- 定义表</span></span><br><span class="line">&gt; <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(tab1) <span class="keyword">do</span></span><br><span class="line">&gt;&gt;     <span class="built_in">print</span>(k .. <span class="string">&quot; - &quot;</span> .. v)</span><br><span class="line">&gt;&gt; <span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 遍历输出表元素</span></span><br><span class="line"><span class="number">1</span> - val3</span><br><span class="line">key1 - val1</span><br><span class="line">key2 - val2</span><br><span class="line">&gt;  </span><br><span class="line"><span class="comment">-- 将表的元素置为nil</span></span><br><span class="line">&gt; tab1.key1 = <span class="literal">nil</span></span><br><span class="line">&gt; <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(tab1) <span class="keyword">do</span></span><br><span class="line">&gt;&gt;     <span class="built_in">print</span>(k .. <span class="string">&quot; - &quot;</span> .. v)</span><br><span class="line">&gt;&gt; <span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 再次遍历表，发现已经删除了一个元素</span></span><br><span class="line"><span class="number">1</span> - val3</span><br><span class="line">key2 - val2</span><br><span class="line">&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="boolean-类型"><a href="#boolean-类型" class="headerlink" title="boolean 类型"></a>boolean 类型</h3><p>boolean 类型只有两个可选值： true、false；<br>Lua 把false、nil看作是“假”，其他都是“真”。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 查看boolean.lua里面的脚本内容</span><br><span class="line">cat boolean.lua </span><br><span class="line"><span class="keyword">if</span> <span class="literal">false</span> <span class="keyword">or</span> <span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;至少有一个是 true&quot;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;false 和 nil 都为 false!&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">lua boolean.lua <span class="comment">-- 执行脚本文件</span></span><br><span class="line"><span class="literal">false</span> 和 <span class="literal">nil</span> 都为 <span class="literal">false</span>!  <span class="comment">-- 输出结果</span></span><br></pre></td></tr></table></figure>

<h3 id="number-类型"><a href="#number-类型" class="headerlink" title="number 类型"></a>number 类型</h3><p>Lua 只有一种number 的双精度类型（默认类型可以修改luaconf.h里的定义）。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">2.2</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">0.2</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">2e+1</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">0.2e-1</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">7.8263692594256e-06</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 运行结果：</span></span><br><span class="line">number</span><br><span class="line">number</span><br><span class="line">number</span><br><span class="line">number</span><br><span class="line">number</span><br><span class="line">number</span><br></pre></td></tr></table></figure>

<h3 id="string-字符串"><a href="#string-字符串" class="headerlink" title="string 字符串"></a>string 字符串</h3><p>字符串由一堆双引号或单引号来表示。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string1 = <span class="string">&quot;this is string1&quot;</span></span><br><span class="line">string2 = <span class="string">&#x27;this is string2&#x27;</span></span><br></pre></td></tr></table></figure>

<p>也可以用2个方括号“[[]]”来表示”一块” 字符串。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">html = <span class="string">[[</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;a href=&quot;http://www.baidu.com/&quot;&gt;回到百度&lt;/a&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">]]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(html)</span><br><span class="line"><span class="comment">-- 输出结果为：</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    a href=<span class="string">&quot;http://www.baidu.com/&quot;</span>&gt;回到百度&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> 当尝试对一个数字字符串上进行算术操作时，Lua 会尝试将这个数字字符串转换成一个数字。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;123.4&quot;</span> + <span class="number">4</span>)</span><br><span class="line"><span class="number">127.4</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> 字符串连接符号为： <strong>..</strong></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;a&quot;</span> .. <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">ab</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;a&quot;</span> .. <span class="number">456</span>)</span><br><span class="line">a456</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> 使用 <strong>#</strong> 符号来计算字符串的长度，放在字符串的前面。</p>
 <figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; str = <span class="string">&quot;Hello,girl!&quot;</span></span><br><span class="line">&gt; <span class="built_in">print</span>(#str)</span><br><span class="line"><span class="number">11</span></span><br></pre></td></tr></table></figure>

<h3 id="table-表"><a href="#table-表" class="headerlink" title="table 表"></a>table 表</h3><p>在 Lua里， table的创建是通过“构造表达式”来完成的，最简单的构造表达式是{}，用来创建一个空表。也可以在表里添加一些数据，直接初始化表。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; tab1 = &#123;&#125;</span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="built_in">type</span>(tab1))</span><br><span class="line"><span class="built_in">table</span></span><br><span class="line">&gt; tab2 = &#123;<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;orange&quot;</span>&#125;</span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="built_in">type</span>(tab2))</span><br><span class="line"><span class="built_in">table</span></span><br></pre></td></tr></table></figure>

<p>Lua 中的表是一个关联数组，数组的索引可以是一个数字或者字符串。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; a = &#123;&#125;</span><br><span class="line">&gt; a[<span class="string">&quot;kel1&quot;</span>] = <span class="string">&quot;val1&quot;</span></span><br><span class="line">&gt; a[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">print</span>(a[<span class="number">1</span>])</span><br><span class="line"><span class="number">1</span></span><br><span class="line">&gt; <span class="built_in">print</span>(a[<span class="string">&quot;kel1&quot;</span>])</span><br><span class="line">val1</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> 和其他语言不一样，Lua表的默认初始索引值一般从1开始。</p>
<h3 id="function-函数"><a href="#function-函数" class="headerlink" title="function 函数"></a>function 函数</h3><p>在Lua中，函数被看作是“第一类值（first-CLass Value）”，函数可以存在变量里。使用 <strong>function</strong> 关键字定义。</p>
<p>创建一个文件，写入：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;&#x27; &gt; func.lua</span><br><span class="line"></span><br><span class="line">vim func.lua </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 写入以下内容</span></span></span><br><span class="line"></span><br><span class="line">function factorial1(n)</span><br><span class="line">    if n == 0 then</span><br><span class="line">        return 1</span><br><span class="line">    else</span><br><span class="line">        return n * factorial1(n - 1)</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">print(factorial1(5))</span><br><span class="line">factorial2 = factorial1</span><br><span class="line">print(factorial2(5))</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写入完毕</span></span><br><span class="line">ESC键，输入:符号，wq! 保存退出</span><br></pre></td></tr></table></figure>

<p>执行脚本文件: </p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lua func.lua </span><br><span class="line"><span class="number">120</span></span><br><span class="line"><span class="number">120</span></span><br></pre></td></tr></table></figure>

<p>我们定义了一个函数，并调用它。<br>然后将函数factorial1赋值给另一个变量factorial2，再调用另外一个变量factorial2（函数）。</p>
<p>function 还可以以匿名函数的方式通过参数传递：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- function_test2.lua 脚本文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFun</span><span class="params">(tab,fun)</span></span></span><br><span class="line">    <span class="keyword">for</span> k ,v <span class="keyword">in</span> <span class="built_in">pairs</span>(tab) <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">print</span>(fun(k,v));</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tab=&#123;key1=<span class="string">&quot;val1&quot;</span>,key2=<span class="string">&quot;val2&quot;</span>&#125;;</span><br><span class="line">testFun(tab,</span><br><span class="line"><span class="function"><span class="keyword">function</span><span class="params">(key,val)</span></span><span class="comment">--匿名函数</span></span><br><span class="line">    <span class="keyword">return</span> key..<span class="string">&quot;=&quot;</span>..val;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>执行脚本:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lua function_test2.lua </span><br><span class="line">key1 = val1</span><br><span class="line">key2 = val2</span><br></pre></td></tr></table></figure>

<h3 id="thread-线程"><a href="#thread-线程" class="headerlink" title="thread 线程"></a>thread 线程</h3><p>再Lua里，最主要的是协程（coroutine）。它跟线程差不多，拥有自己独立的栈、局部变量和指令指针，可以跟其它协程共享全局变量和其它大部分东西。</p>
<h2 id="Lua-变量"><a href="#Lua-变量" class="headerlink" title="Lua 变量"></a>Lua 变量</h2><p>Lua变量有三种类型： 全局变量、局部变量、表中的域。<br>Lua中的变量全是全局变量，哪怕是语句块或是函数里，除非用local显式声明为局部变量。<br>局部变量的作用域为从声明位置开始到所在语句块结束。<br>变量的值默认为nil。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- test.lua 文件脚本</span></span><br><span class="line">a = <span class="number">5</span>               <span class="comment">-- 全局变量</span></span><br><span class="line"><span class="keyword">local</span> b = <span class="number">5</span>         <span class="comment">-- 局部变量</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">joke</span><span class="params">()</span></span></span><br><span class="line">    c = <span class="number">5</span>           <span class="comment">-- 全局变量</span></span><br><span class="line">    <span class="keyword">local</span> d = <span class="number">6</span>     <span class="comment">-- 局部变量</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">joke()</span><br><span class="line"><span class="built_in">print</span>(c,d)          <span class="comment">--&gt; 5 nil</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">    <span class="keyword">local</span> a = <span class="number">6</span>     <span class="comment">-- 局部变量</span></span><br><span class="line">    b = <span class="number">6</span>           <span class="comment">-- 对局部变量重新赋值</span></span><br><span class="line">    <span class="built_in">print</span>(a,b);     <span class="comment">--&gt; 6 6</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a,b)      <span class="comment">--&gt; 5 6</span></span><br></pre></td></tr></table></figure>

<p>执行lua test.lua 输出结果为:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lua test.lua</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="赋值语句"><a href="#赋值语句" class="headerlink" title="赋值语句"></a>赋值语句</h3><p>Lua 可以对多个变量同时赋值，变量列表和值列表的各个元素用逗号隔开，赋值语句右边的值会一次赋给左边的变量。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a, n = <span class="number">10</span>, <span class="number">2</span>*<span class="number">6</span></span><br></pre></td></tr></table></figure>

<p>遇到赋值语句Lua会先计算右边所有的值然后再执行赋值操作，所以可以这样交换变量的值：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x, y = y, x  <span class="comment">-- 直接交换了x，y二者的值；和python一样</span></span><br><span class="line">a[i], a[j] = a[j], a[i] <span class="comment">-- 直接交换二者</span></span><br></pre></td></tr></table></figure>

<p>当变量个数和值个数不匹配时，Lua以变量个数为基础，值不够的默认为nil；值过多的忽略。</p>
<p>Lua支持函数返回多个值，可以采用多值赋值：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="function"><span class="keyword">function</span> <span class="title">multival</span><span class="params">()</span></span></span><br><span class="line">&gt;&gt;     <span class="keyword">return</span> <span class="number">1</span>, <span class="number">2</span></span><br><span class="line">&gt;&gt; <span class="keyword">end</span></span><br><span class="line">&gt; f, g = multival()</span><br><span class="line">&gt; <span class="built_in">print</span>(f, g)</span><br><span class="line"><span class="number">1</span>       <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p><strong>总结：</strong> 应该尽可能使用局部变量，有两个好处：</p>
<ul>
<li>避免命名冲突</li>
<li>访问局部变量速度比全局变量更快</li>
</ul>
<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p>对table的索引使用方括号 **[]**。Lua 也提供了 <strong>.</strong> 操作。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t[i]</span><br><span class="line">t.i                 <span class="comment">-- 当索引为字符串类型时的一种简化写法</span></span><br><span class="line">gettable_event(t,i) <span class="comment">-- 采用索引访问本质上是一个类似这样的函数调用</span></span><br></pre></td></tr></table></figure>

<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; arr = &#123;&#125;</span><br><span class="line">&gt; arr[<span class="string">&quot;name&quot;</span>] = <span class="string">&#x27;Mary&#x27;</span></span><br><span class="line">&gt; <span class="built_in">print</span>(arr[<span class="string">&quot;name&quot;</span>])</span><br><span class="line">Mary</span><br><span class="line">&gt; <span class="built_in">print</span>(arr.name)</span><br><span class="line">Mary</span><br></pre></td></tr></table></figure>


<h1 id="Lua-语言编程指南"><a href="#Lua-语言编程指南" class="headerlink" title="Lua 语言编程指南"></a>Lua 语言编程指南</h1><h2 id="Lua-循环"><a href="#Lua-循环" class="headerlink" title="Lua 循环"></a>Lua 循环</h2><p>Lua 提供了以下几种循环处理方式：</p>
<table>
<thead>
<tr>
<th>循环类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>while循环</td>
<td>在条件为 true 时，让程序重复地执行某些语句。执行语句前会先检查条件是否为 true。</td>
</tr>
<tr>
<td>for循环</td>
<td>重复执行指定语句，重复次数可在 for 语句中控制</td>
</tr>
<tr>
<td>repeat…until</td>
<td>重复执行循环，直到 指定的条件为真时为止</td>
</tr>
<tr>
<td>循环嵌套</td>
<td>可以在循环内嵌套一个或多个循环语句（while do … end;for … do … end;repeat … until;）</td>
</tr>
</tbody></table>
<h3 id="while-循环"><a href="#while-循环" class="headerlink" title="while 循环"></a>while 循环</h3><p>语法：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(condition)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   statements</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="number">10</span></span><br><span class="line"><span class="keyword">while</span>( a &lt; <span class="number">20</span> )</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;a 的值为:&quot;</span>, a)</span><br><span class="line">   a = a+<span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line">a 的值为:    <span class="number">10</span></span><br><span class="line">a 的值为:    <span class="number">11</span></span><br><span class="line">a 的值为:    <span class="number">12</span></span><br><span class="line">a 的值为:    <span class="number">13</span></span><br><span class="line">a 的值为:    <span class="number">14</span></span><br><span class="line">a 的值为:    <span class="number">15</span></span><br><span class="line">a 的值为:    <span class="number">16</span></span><br><span class="line">a 的值为:    <span class="number">17</span></span><br><span class="line">a 的值为:    <span class="number">18</span></span><br><span class="line">a 的值为:    <span class="number">19</span></span><br></pre></td></tr></table></figure>

<h3 id="for-循环"><a href="#for-循环" class="headerlink" title="for 循环"></a>for 循环</h3><p>for循环分为两大类：</p>
<ul>
<li>数值for循环</li>
<li>泛型for循环</li>
</ul>
<h4 id="数值for循环"><a href="#数值for循环" class="headerlink" title="数值for循环"></a>数值for循环</h4><p>语法格式：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> var=exp1,exp2,exp3 <span class="keyword">do</span></span><br><span class="line">    &lt;语句块&gt;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>var 从 exp1 变化到 exp2，每次变化以exp3为步长递增var，并执行一次语句块。exp3可选，不指定则默认为1.<br>示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">10</span>, <span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">&gt;&gt; <span class="built_in">print</span>(i)</span><br><span class="line">&gt;&gt; <span class="keyword">end</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure>


<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i=<span class="number">1</span>,f(x) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i=<span class="number">10</span>,<span class="number">1</span>,<span class="number">-1</span> <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong> for的三个表达式在循环开始前一次性求值，以后不再进行求值。比如上面的f(x)只会在循环开始前执行一次，其结果用在后面的循环中</p>
<h4 id="泛型for循环"><a href="#泛型for循环" class="headerlink" title="泛型for循环"></a>泛型for循环</h4><p>泛型for循环通过一个迭代器函数来遍历所有的值，类似java中的foreach语句。<br>语法格式：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(a) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(i, v)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>i 是数组索引值， v是对应索引的数组元素值。 <strong>ipairs</strong> 是 Lua 提供的一个迭代器函数，用来迭代数组。</p>
<p>示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; arr = &#123;<span class="string">&quot;Lily&quot;</span>, <span class="string">&quot;Jim&quot;</span>, <span class="string">&quot;Lucy&quot;</span>, <span class="string">&quot;Kate&quot;</span>&#125;</span><br><span class="line">&gt; <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(arr) <span class="keyword">do</span></span><br><span class="line">&gt;&gt;     <span class="built_in">print</span>(<span class="string">&quot;arr[&quot;</span> .. i .. <span class="string">&quot;]=&quot;</span> .. v)</span><br><span class="line">&gt;&gt; <span class="keyword">end</span></span><br><span class="line">arr[<span class="number">1</span>]=Lily</span><br><span class="line">arr[<span class="number">2</span>]=Jim</span><br><span class="line">arr[<span class="number">3</span>]=Lucy</span><br><span class="line">arr[<span class="number">4</span>]=Kate</span><br></pre></td></tr></table></figure>

<h3 id="repeat…until-循环"><a href="#repeat…until-循环" class="headerlink" title="repeat…until 循环"></a>repeat…until 循环</h3><p>repeat…until条件语句在当前循环结束后进行判断。</p>
<p>语法格式：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">repeat</span></span><br><span class="line">    statements</span><br><span class="line"><span class="keyword">until</span>(condition)</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">repeat</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;a的当前值&quot;</span>, a)</span><br><span class="line">    a = a + <span class="number">1</span></span><br><span class="line"><span class="keyword">until</span>(a &gt; <span class="number">15</span>)</span><br></pre></td></tr></table></figure>
<p>输出a的值，直到a的值大于15的时候，运行结果如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; a = <span class="number">10</span></span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">repeat</span></span><br><span class="line">&gt;&gt;     <span class="built_in">print</span>(<span class="string">&quot;a的当前值&quot;</span>, a)</span><br><span class="line">&gt;&gt;     a = a + <span class="number">1</span></span><br><span class="line">&gt;&gt; <span class="keyword">until</span>(a &gt; <span class="number">15</span>)</span><br><span class="line">a的当前值       <span class="number">10</span></span><br><span class="line">a的当前值       <span class="number">11</span></span><br><span class="line">a的当前值       <span class="number">12</span></span><br><span class="line">a的当前值       <span class="number">13</span></span><br><span class="line">a的当前值       <span class="number">14</span></span><br><span class="line">a的当前值       <span class="number">15</span></span><br></pre></td></tr></table></figure>


<h2 id="Lua-流程控制语句"><a href="#Lua-流程控制语句" class="headerlink" title="Lua 流程控制语句"></a>Lua 流程控制语句</h2><p><strong>注意</strong>：Lua中除了false、nil为“假”之外其他所有值全部为“真”，0也是“真”。</p>
<table>
<thead>
<tr>
<th>语句</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>if语句</td>
<td>if 语句 由一个布尔表达式作为条件判断，其后紧跟其他语句组成。</td>
</tr>
<tr>
<td>if…else语句</td>
<td>if 语句 可以与 else 语句搭配使用, 在 if 条件表达式为 false 时执行 else 语句代码</td>
</tr>
<tr>
<td>if嵌套语句</td>
<td>可以在if 或 else if中使用一个或多个 if 或 else if 语句 。</td>
</tr>
</tbody></table>
<h3 id="if-语句"><a href="#if-语句" class="headerlink" title="if 语句"></a>if 语句</h3><p>语法格式：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(布尔表达式)</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="comment">-- 语句块</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (a &lt; <span class="number">20</span>)</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;值小于20&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;a的值为:&quot;</span>, a)</span><br></pre></td></tr></table></figure>

<h3 id="if…else-语句"><a href="#if…else-语句" class="headerlink" title="if…else 语句"></a>if…else 语句</h3><p>语法格式：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (布尔表达式)</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="comment">--语句块</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="comment">--语句块</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">score = <span class="number">90</span></span><br><span class="line"><span class="keyword">if</span>(score &gt;= <span class="number">90</span>)</span><br><span class="line"><span class="keyword">then</span> </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;优秀&quot;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;一般&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"># 输出：</span><br><span class="line">优秀</span><br></pre></td></tr></table></figure>

<h3 id="if…elseif…else-语句"><a href="#if…elseif…else-语句" class="headerlink" title="if…elseif…else 语句"></a>if…elseif…else 语句</h3><p>示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--[ 定义变量 --]</span></span><br><span class="line">a = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--[ 检查布尔条件 --]</span></span><br><span class="line"><span class="keyword">if</span>( a == <span class="number">10</span> )</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="comment">--[ 如果条件为 true 打印以下信息 --]</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;a 的值为 10&quot;</span> )</span><br><span class="line"><span class="keyword">elseif</span>( a == <span class="number">20</span> )</span><br><span class="line"><span class="keyword">then</span>   </span><br><span class="line">   <span class="comment">--[ if else if 条件为 true 时打印以下信息 --]</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;a 的值为 20&quot;</span> )</span><br><span class="line"><span class="keyword">elseif</span>( a == <span class="number">30</span> )</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="comment">--[ if else if condition 条件为 true 时打印以下信息 --]</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;a 的值为 30&quot;</span> )</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="comment">--[ 以上条件语句没有一个为 true 时打印以下信息 --]</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;没有匹配 a 的值&quot;</span> )</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;a 的真实值为: &quot;</span>, a )</span><br></pre></td></tr></table></figure>

<p>这是一个给考试分数判定级别的分支程序：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt; score = <span class="number">85</span></span><br><span class="line">&gt; <span class="keyword">if</span>(score&gt;<span class="number">90</span>)</span><br><span class="line">&gt;&gt; <span class="keyword">then</span></span><br><span class="line">&gt;&gt;     <span class="built_in">print</span>(<span class="string">&quot;优秀,分数:&quot;</span>, score)</span><br><span class="line">&gt;&gt; <span class="keyword">elseif</span>(score&gt;=<span class="number">80</span>)</span><br><span class="line">&gt;&gt; <span class="keyword">then</span></span><br><span class="line">&gt;&gt;     <span class="built_in">print</span>(<span class="string">&quot;良好,分数:&quot;</span>, score)</span><br><span class="line">&gt;&gt; <span class="keyword">elseif</span>(score&gt;=<span class="number">70</span>)</span><br><span class="line">&gt;&gt; <span class="keyword">then</span></span><br><span class="line">&gt;&gt;     <span class="built_in">print</span>(<span class="string">&quot;一般,分数:&quot;</span>, score)</span><br><span class="line">&gt;&gt; <span class="keyword">elseif</span>(score&gt;=<span class="number">60</span>)</span><br><span class="line">&gt;&gt; <span class="keyword">then</span> </span><br><span class="line">&gt;&gt;     <span class="built_in">print</span>(<span class="string">&quot;合格,分数:&quot;</span>, score)</span><br><span class="line">&gt;&gt; <span class="keyword">else</span></span><br><span class="line">&gt;&gt;     <span class="built_in">print</span>(<span class="string">&quot;较差,分数:&quot;</span>, score)</span><br><span class="line">&gt;&gt; <span class="keyword">end</span></span><br><span class="line">良好,分数:      <span class="number">85</span></span><br></pre></td></tr></table></figure>

<h3 id="if嵌套语句"><a href="#if嵌套语句" class="headerlink" title="if嵌套语句"></a>if嵌套语句</h3><p>语法格式类似：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( 布尔表达式 <span class="number">1</span>)</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="comment">--[ 布尔表达式 1 为 true 时执行该语句块 --]</span></span><br><span class="line">   <span class="keyword">if</span>(布尔表达式 <span class="number">2</span>)</span><br><span class="line">   <span class="keyword">then</span></span><br><span class="line">      <span class="comment">--[ 布尔表达式 2 为 true 时执行该语句块 --]</span></span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h2 id="Lua-函数"><a href="#Lua-函数" class="headerlink" title="Lua 函数"></a>Lua 函数</h2><p>函数定义语法格式：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">optional_function_scope <span class="function"><span class="keyword">function</span> <span class="title">function_name</span><span class="params">( argument1, argument2, argument3..., argumentn)</span></span></span><br><span class="line">    function_body</span><br><span class="line">    <span class="keyword">return</span> result_params_comma_separated</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<ul>
<li>optional_function_scope: 可选的指定函数是全局函数还是局部函数，默认为全局的； 局部使用 <strong>local</strong> 修饰。</li>
<li>function_name： 指定函数名称。</li>
<li>argument1, argument2, argument3…, argumentn：函数参数列表，逗号隔开，也可以不带参数。</li>
<li>function_body： 函数体</li>
<li>result_params_comma_separated：函数返回值，Lua语言函数可以返回多个值，用逗号隔开</li>
</ul>
<p>示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">max</span><span class="params">(num1, num2)</span></span></span><br><span class="line">    <span class="keyword">if</span>(num1 &gt; num2) <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span> num1</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> num2</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;比较二者的最大数：&quot;</span>, <span class="built_in">max</span>(<span class="number">1</span>, <span class="number">4</span>))  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;比较二者的最大数：&quot;</span>, <span class="built_in">max</span>(<span class="number">20</span>, <span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<p>Lua 中可以将函数作为参数传递给函数，示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">myprint = <span class="function"><span class="keyword">function</span><span class="params">(param)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;这是我的打印函数，打印param:&quot;</span>, param)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(num1, num2, func4Print)</span></span></span><br><span class="line">     func4Print(num1 + num2)</span><br><span class="line"><span class="keyword">end</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>, <span class="number">3</span>, myprint)   </span><br><span class="line">- 输出：</span><br><span class="line">这是我的打印函数，打印param:    <span class="number">5</span></span><br></pre></td></tr></table></figure>

<h3 id="多返回值函数"><a href="#多返回值函数" class="headerlink" title="多返回值函数"></a>多返回值函数</h3><p>Lua 函数可以返回多个值，比如 string.find，其返回匹配串“开始和结束的下标”（如果不存在匹配串则返回nil）</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">find</span>(<span class="string">&quot;www.baidu.com&quot;</span>, <span class="string">&quot;baidu&quot;</span>))</span><br><span class="line"><span class="number">5</span>       <span class="number">9</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">maximum</span> <span class="params">(a)</span></span></span><br><span class="line">    <span class="keyword">local</span> mi = <span class="number">1</span>             <span class="comment">-- 最大值索引</span></span><br><span class="line">    <span class="keyword">local</span> m = a[mi]          <span class="comment">-- 最大值</span></span><br><span class="line">    <span class="keyword">for</span> i,val <span class="keyword">in</span> <span class="built_in">ipairs</span>(a) <span class="keyword">do</span></span><br><span class="line">       <span class="keyword">if</span> val &gt; m <span class="keyword">then</span></span><br><span class="line">           mi = i</span><br><span class="line">           m = val</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> m, mi</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(maximum(&#123;<span class="number">8</span>,<span class="number">10</span>,<span class="number">23</span>,<span class="number">12</span>,<span class="number">5</span>&#125;))</span><br><span class="line"><span class="comment">-- 输出 </span></span><br><span class="line"><span class="number">23</span>    <span class="number">3</span></span><br></pre></td></tr></table></figure>

<h3 id="可变参数函数"><a href="#可变参数函数" class="headerlink" title="可变参数函数"></a>可变参数函数</h3><p>Lua 函数支持可变参数。 和C语言类似，在参数列表中使用三点符 <strong>…</strong> 表示函数有可变的参数</p>
<p>示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(...)</span></span> <span class="comment">--可变参数</span></span><br><span class="line"><span class="keyword">local</span> s = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">ipairs</span>&#123;...&#125; <span class="keyword">do</span> <span class="comment">-- &#123;...&#125;表示一个可变长参数构成的数组</span></span><br><span class="line">        s = s + v</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(add(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>))</span><br><span class="line"><span class="comment">-- 输出结果为：</span></span><br><span class="line"><span class="number">25</span></span><br></pre></td></tr></table></figure>

<p><strong>select(“#”, …)</strong> 表达式来获取可变参数的个数</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">average</span><span class="params">(...)</span></span></span><br><span class="line">   result = <span class="number">0</span></span><br><span class="line">   <span class="keyword">local</span> <span class="built_in">arg</span>=&#123;...&#125;</span><br><span class="line">   <span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(<span class="built_in">arg</span>) <span class="keyword">do</span></span><br><span class="line">      result = result + v</span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;总共传入 &quot;</span> .. <span class="built_in">select</span>(<span class="string">&quot;#&quot;</span>,...) .. <span class="string">&quot; 个数&quot;</span>)</span><br><span class="line">   <span class="keyword">return</span> result/<span class="built_in">select</span>(<span class="string">&quot;#&quot;</span>,...)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;平均值为&quot;</span>,average(<span class="number">10</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 输出结果为：</span></span><br><span class="line">总共传入 <span class="number">6</span> 个数</span><br><span class="line">平均值为        <span class="number">5.5</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>： 有时候需要几个固定参数 + 可变参数， 固定参数必须放在可变参数之前。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fwrite</span><span class="params">(fmt, ...)</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">io</span>.<span class="built_in">write</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(fmt, ...))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">fwrite(<span class="string">&quot;helloboy\n&quot;</span>)</span><br><span class="line"><span class="comment">-- 输出</span></span><br><span class="line">helloboy</span><br></pre></td></tr></table></figure>


<ul>
<li>select(“#”, …) : 返回可变参数的长度</li>
<li>select(n, …) : 用于访问 n 到 select(“#”, …) 的参数</li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span>, <span class="built_in">select</span>(<span class="string">&#x27;#&#x27;</span>, ...) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> <span class="built_in">arg</span> = <span class="built_in">select</span>(i, ...)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;arg&quot;</span>, <span class="built_in">arg</span>) </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">foo(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 输出结果为：</span></span><br><span class="line"><span class="built_in">arg</span>     <span class="number">1</span></span><br><span class="line"><span class="built_in">arg</span>     <span class="number">2</span></span><br><span class="line"><span class="built_in">arg</span>     <span class="number">3</span></span><br><span class="line"><span class="built_in">arg</span>     <span class="number">4</span></span><br></pre></td></tr></table></figure>

<h2 id="Lua-运算符"><a href="#Lua-运算符" class="headerlink" title="Lua 运算符"></a>Lua 运算符</h2><p>Lua 提供了以下几种运算符：</p>
<ul>
<li>算术运算符</li>
<li>关系运算符</li>
<li>逻辑运算符</li>
<li>其他运算符</li>
</ul>
<h3 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h3><p>+、-、*、&#x2F;、%、^（乘幂，例如 2^2 值为 4）、-（负号）。</p>
<h3 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h3><table>
<thead>
<tr>
<th>操作符</th>
<th>描述</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>&#x3D;&#x3D;</td>
<td>等于</td>
<td>1&#x3D;&#x3D;1 为true</td>
</tr>
<tr>
<td><strong>~&#x3D;</strong></td>
<td>不等于</td>
<td>1~&#x3D;1为false</td>
</tr>
<tr>
<td>&gt;</td>
<td>大于</td>
<td>2&gt;1为true</td>
</tr>
<tr>
<td>&lt;</td>
<td>小于</td>
<td>1&lt;2为true</td>
</tr>
<tr>
<td>&gt;&#x3D;</td>
<td>大于等于</td>
<td>1&gt;&#x3D;1为true</td>
</tr>
<tr>
<td>&lt;&#x3D;</td>
<td>小于等于</td>
<td>1&lt;&#x3D;2为true</td>
</tr>
</tbody></table>
<h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><p>逻辑运算符共有三个，示例，假设A为true，B为false</p>
<ul>
<li>and ： A and B 为false</li>
<li>or ： A or B 为true</li>
<li>not ： not(A and B) 为true</li>
</ul>
<h3 id="其他运算符"><a href="#其他运算符" class="headerlink" title="其他运算符"></a>其他运算符</h3><table>
<thead>
<tr>
<th>操作符</th>
<th>描述</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>..</strong></td>
<td>连接两个字符串</td>
<td>a &#x3D; “Hello”, b &#x3D; “World!”, a..b &#x3D; “HelloWorld!”</td>
</tr>
<tr>
<td><strong>#</strong></td>
<td>返回字符串或表的长度</td>
<td>#”Hello” 返回5</td>
</tr>
</tbody></table>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; a = <span class="string">&quot;Hello&quot;</span></span><br><span class="line">&gt; b = <span class="string">&quot;,world!&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">print</span>(a..b)</span><br><span class="line">Hello,world!</span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">print</span>(#a)</span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>运算符优先级：<br>除了^和..外所有的二元运算符都是左连接的。从高到低的顺序依次是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">^</span><br><span class="line">not    - (unary)</span><br><span class="line">*      /</span><br><span class="line">+      -</span><br><span class="line">..</span><br><span class="line">&lt;      &gt;      &lt;=     &gt;=     ~=     ==</span><br><span class="line">and</span><br><span class="line">or</span><br></pre></td></tr></table></figure>

<h2 id="Lua-字符串"><a href="#Lua-字符串" class="headerlink" title="Lua 字符串"></a>Lua 字符串</h2><p>Lua 中的字符串可以使用以下三种方式来表示：</p>
<ul>
<li>单引号之间的一串字符</li>
<li>双引号之间的一串字符</li>
<li>[[ 和 ]] 之间的一串字符</li>
</ul>
<p>示例如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; str = <span class="string">[[&quot;你好&quot;]]</span></span><br><span class="line">&gt; <span class="built_in">print</span>(str)</span><br><span class="line"><span class="string">&quot;你好&quot;</span></span><br><span class="line">&gt; str = <span class="string">[[你好]]</span></span><br><span class="line">&gt; <span class="built_in">print</span>(str)</span><br><span class="line">你好</span><br></pre></td></tr></table></figure>

<h3 id="字符串操作函数"><a href="#字符串操作函数" class="headerlink" title="字符串操作函数"></a>字符串操作函数</h3><p>字符串string提供了一系列静态方法</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>函数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>string.upper(argument)</td>
<td>字符串全部转换为大写字母</td>
</tr>
<tr>
<td>2</td>
<td>string.lower(argument)</td>
<td>字符串全部转换为小写</td>
</tr>
<tr>
<td>3</td>
<td>string.gsub(main String, find String, replaceString, num)</td>
<td>在字符串中替换，mianString为与奥替换的字符串，findString为被替换的字符，replaceString为要替换的字符，num替换次数（不指定则全部替换）</td>
</tr>
<tr>
<td>4</td>
<td>string.find(str, substr, [init,[end]])</td>
<td>在一个制定的目标字符串中搜索指定的内容（第三个参数为索引）。返回其具体位置，不存在则返回nil</td>
</tr>
<tr>
<td>5</td>
<td>string.reverse(arg)</td>
<td>字符串反转</td>
</tr>
<tr>
<td>6</td>
<td>string.format(…)</td>
<td>返回一个类似print的格式化字符串</td>
</tr>
<tr>
<td>7</td>
<td>string.char(arg)和string.byte(arg[,int])</td>
<td>char将整型字转换成字符并连接，byte转换字符为整数值（可以指定某个字符，默认第一个字符）</td>
</tr>
<tr>
<td>8</td>
<td>string.length(arg)</td>
<td>计算字符串长度</td>
</tr>
<tr>
<td>9</td>
<td>string.rep(string, n)</td>
<td>返回字符串string的n个拷贝</td>
</tr>
<tr>
<td>10</td>
<td>..</td>
<td>连接两个字符</td>
</tr>
<tr>
<td>11</td>
<td>string.gmatch(str, pattern)</td>
<td>一个迭代器函数，每一次调用这个函数，返回一个在字符串str找到的下一个符合pattern描述的字串。如果参数pattern描述的字符串没有找到，迭代函数返回nil</td>
</tr>
<tr>
<td>12</td>
<td>string.match(str, pattern, init)</td>
<td>只寻找源字串str中的第一个配对，参数init可选，指定搜寻过程的起点，默认为1.在成功配对时，函数将返回配对表达式中的所有捕获结果，如果没有设置捕获标记，则返回整个配对字符串，当没有成功的配对时，返回nil。</td>
</tr>
</tbody></table>
<h2 id="Luau数组"><a href="#Luau数组" class="headerlink" title="Luau数组"></a>Luau数组</h2><p>数组，是相同数据类型的元素按照一定顺序排列的集合，可以是一维数组和多维数组<br>Lua 数组的索引值可以使用整数表示，数组的大小不是固定的。</p>
<h3 id="一维数组"><a href="#一维数组" class="headerlink" title="一维数组"></a>一维数组</h3><p>是最简单的数组，逻辑是线性表。 一维数组可以用for循环出数组中的元素。 如下示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">array = &#123;<span class="string">&quot;Lua&quot;</span>, <span class="string">&quot;Hello&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i=<span class="number">0</span>, <span class="number">2</span> <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(array[i])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 输出结果为：</span></span><br><span class="line"><span class="literal">nil</span></span><br><span class="line">Lua</span><br><span class="line">Hello</span><br></pre></td></tr></table></figure>

<p>在 Lua 中索引值是从 1开始的， 如果指定的索引没有值则返回nil。还可以是负值。</p>
<h3 id="多维数组"><a href="#多维数组" class="headerlink" title="多维数组"></a>多维数组</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 初始化数组</span></span><br><span class="line">array = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i=<span class="number">1</span>,<span class="number">3</span> <span class="keyword">do</span></span><br><span class="line">   array[i] = &#123;&#125;</span><br><span class="line">      <span class="keyword">for</span> j=<span class="number">1</span>,<span class="number">3</span> <span class="keyword">do</span></span><br><span class="line">         array[i][j] = i*j</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 访问数组</span></span><br><span class="line"><span class="keyword">for</span> i=<span class="number">1</span>,<span class="number">3</span> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j=<span class="number">1</span>,<span class="number">3</span> <span class="keyword">do</span></span><br><span class="line">      <span class="built_in">print</span>(array[i][j])</span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>


<h2 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h2><p>迭代器是一种对象，能够用来遍历标准模板库容器中的部分或全部元素，每个迭代器对象代表容器中的确定的地址。<br>在Lua中迭代器一种支持指针类型的结构，可以遍历集合的每一个元素。</p>
<h3 id="泛型-for-迭代器"><a href="#泛型-for-迭代器" class="headerlink" title="泛型 for 迭代器"></a>泛型 for 迭代器</h3><p>泛型 for 在自己内部保存迭代器，实际上它保存三个值： 迭代函数、状态常量、控制变量。<br>泛型 for 迭代器提供了集合的 key&#x2F;value 对， 语法格式如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(t) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(k, v)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; arr = &#123;<span class="string">&quot;Lua&quot;</span>, <span class="string">&quot;Hello&quot;</span>&#125;</span><br><span class="line">&gt; <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(arr) <span class="keyword">do</span></span><br><span class="line">&gt;&gt;     <span class="built_in">print</span>(i, v)</span><br><span class="line">&gt;&gt; <span class="keyword">end</span></span><br><span class="line"><span class="number">1</span>       Lua</span><br><span class="line"><span class="number">2</span>       Hello</span><br></pre></td></tr></table></figure>

<p>在Lua中我们常常使用函数来描述迭代器，每次调用该函数就返回集合的下一个元素。Lua的迭代器包含以下两种类型：</p>
<ul>
<li>无状态的迭代器</li>
<li>多状态的迭代器</li>
</ul>
<h3 id="无状态的迭代器"><a href="#无状态的迭代器" class="headerlink" title="无状态的迭代器"></a>无状态的迭代器</h3><p>无状态的迭代器是指不保留任何状态的迭代器，因此在循环中我们可以利用无状态迭代器避免创建闭包花费额外的代价。<br>每一次迭代，迭代函数都是用两个变量（状态控制 和 控制变量）的值作为参数被调用，一个无状态的迭代器只利用这两个值可以获取下一个元素。</p>
<p>这种无状态的迭代器的典型的简单的例子是 ipairs，它遍历数组的每一个元素。<br>一个简单的迭代器实现数字n的平方。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">square</span><span class="params">(iteratorMaxCount, currentNumber)</span></span></span><br><span class="line">    <span class="keyword">if</span> currentNumber &lt; iteratorMaxCount</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        currentNumber = currentNumber + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> currentNumber, currentNumber*currentNumber</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i,n <span class="keyword">in</span> square,<span class="number">3</span>,<span class="number">0</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   <span class="built_in">print</span>(i,n)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 输出：</span></span><br><span class="line"><span class="number">1</span>    <span class="number">1</span></span><br><span class="line"><span class="number">2</span>    <span class="number">4</span></span><br><span class="line"><span class="number">3</span>    <span class="number">9</span></span><br></pre></td></tr></table></figure>

<p>迭代的状态包括被遍历的表（循环过程中不会改变的状态常量）和当前的索引下标（控制变量），ipairs和迭代函数都很简单，还可以这样实现：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iter</span> <span class="params">(a, i)</span></span></span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">local</span> v = a[i]</span><br><span class="line">    <span class="keyword">if</span> v <span class="keyword">then</span></span><br><span class="line">       <span class="keyword">return</span> i, v</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ipairs</span> <span class="params">(a)</span></span></span><br><span class="line">    <span class="keyword">return</span> iter, a, <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>当Lua调用ipairs(a)开始循环的时候，它获取三个值：迭代函数iter、状态常量a、控制变量初始值0；<br>然后Lua调用iter(a,0)返回1,a<a href="%E9%99%A4%E9%9D%9Ea%5B1%5D%E4%B8%BAnil">1</a>;<br>第二次迭代调用 iter(a, 1)，返回2,a[2]……直到第一个nil元素。</p>
<h3 id="多状态的迭代器"><a href="#多状态的迭代器" class="headerlink" title="多状态的迭代器"></a>多状态的迭代器</h3><p>很多情况下，迭代器需要村村多个状态信息而不是简单的状态常量和控制变量，最简单的方法是使用闭包。<br>还有一种方法是将所有的状态信息封装到table中，将table作为迭代器的状态常量，因为这种情况下将所有的信息存放在table内，<br>所以迭代函数通常不需要第二个参数。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iterator</span><span class="params">(collection)</span></span></span><br><span class="line">    <span class="keyword">local</span> index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">local</span> count = #collection</span><br><span class="line">    <span class="comment">--闭包函数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">        index = index + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> index &lt;= count</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="comment">-- 返回迭代器的当前元素</span></span><br><span class="line">            <span class="keyword">return</span> collection[index]</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">array = &#123;<span class="string">&quot;Lua&quot;</span>, <span class="string">&quot;Hello&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ele <span class="keyword">in</span> iterator(array)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(ele)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h2 id="Lua-表-Tbale"><a href="#Lua-表-Tbale" class="headerlink" title="Lua 表 Tbale"></a>Lua 表 Tbale</h2><p>table 是 Lua的一种数据结构，以帮助我们创建不同的数据类型，如：数组、字典等。<br>Lua table 使用关联数组，可以用任意类型的值作为数组的索引，只要索引值不是nil。<br>Lua table 是不固定大小的，剋根据自己需要进行扩充。<br>Lua 也是通过table来解决模块、包和对象的。<br>例如 string.format 表示使用”format”来索引table string。</p>
<h3 id="table-的构造"><a href="#table-的构造" class="headerlink" title="table 的构造"></a>table 的构造</h3><p>构造器是创建和初始化表的表达式。最简单的构造是{}，用以构建一个空表。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">myTb = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 指定值构造</span></span><br><span class="line">myTb[<span class="number">1</span>] = <span class="string">&quot;Hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 移除引用，Lua 垃圾回收会释放内存</span></span><br><span class="line">myTb = nul</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="Lua-模块与包"><a href="#Lua-模块与包" class="headerlink" title="Lua 模块与包"></a>Lua 模块与包</h2><p>模块类似于一个封装库，从Lua5.1开始，Lua加入了标准的模块管理机制，可以把一些公用的代码放在一个文件里。以API接口的形式放在其他地方调用，有利于代码的重用和降低代码耦合度。<br>Lua模块是由变量、函数等已知元素组成的 table，因此创建一个模块很简单，就是创建一个table。<br>自定义一个模块，格式如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 文件名为 module.lua</span></span><br><span class="line"><span class="comment">-- 定义一个名为 module 的模块</span></span><br><span class="line"><span class="built_in">module</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 定义一个常量</span></span><br><span class="line"><span class="built_in">module</span>.constant = <span class="string">&quot;这是一个常量&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 定义一个函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mudule.func1</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">io</span>.<span class="built_in">write</span>(<span class="string">&quot;这是一个公有函数!\n&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">func2</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;这是一个私有函数!&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">module.func3</span><span class="params">()</span></span></span><br><span class="line">    func2()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>func2 声明为程序块的局部变量，表示是一个私有函数，不能从外部直接访问。</p>
<h3 id="模块引入函数-require"><a href="#模块引入函数-require" class="headerlink" title="模块引入函数 require"></a>模块引入函数 require</h3><p>Lua 提供了一个名为 require 的函数来加载模块。要加载一个模块，只需要简单调用就可以了。例如：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&quot;模块名&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或者</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span> <span class="string">&quot;模块名&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>:执行 require 后会返回一个由模块常量或函数组成的table，并且还会定义一个包含该 table 的全局变量。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--当前是 test_module.lua 文件</span></span><br><span class="line"><span class="comment">-- module 模块是前面提到的 module.lua</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;module&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用引入模块的常量</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">module</span>.constant)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用模块内定义的公有函数</span></span><br><span class="line"><span class="built_in">module</span>.func3()</span><br></pre></td></tr></table></figure>

<h3 id="加载机制"><a href="#加载机制" class="headerlink" title="加载机制"></a>加载机制</h3><p>对于自定义的模块，模块文件不是放在那个文件目录都可以的。<br>函数 require 有它自己的文件路径加载策略，会尝试从 Lua 文件 或 C 程序库中加载模块。</p>
<p>require 用于搜索 Lua 文件的路径是存放在全局变量 <code>package.path</code> 中，当 Lua 启动后，会以环境变量 <strong>LUA_PATH</strong> 的值来初始化这个环境变量。<br>如果没有找到该环境变量，则使用一个编译时定义的默认路径来初始化。</p>
<h2 id="Lua-元表"><a href="#Lua-元表" class="headerlink" title="Lua 元表"></a>Lua 元表</h2><p>在 Lua table 中我们可以访问对应的 key 来得到 value 的值，但是却无法对两个 table 进行操作。<br>因此 Lua 提供了元表（Metatable），允许我们改变table的行为，每个行为关联了对应的元方法。<br>例如： 使用 元表我们可以定义 Lua 如何计算两个 table 的相加操作 a+b。<br>当 Lua 试图对两个表进行相加时，先检查两者之一是否有元素，之后检查是否有一个叫 “__add” 的字段，有则调用对应的值。</p>
<p>有2个很重要的函数来处理元素：</p>
<ul>
<li>setmetatable(table, metatable): 对指定 table 设置元表（metatable），如果元表（metatable）中存在  __metatable 键值，setmetatable 会失败。</li>
<li>getmetatable(table): 返回对象的元素（metatable）</li>
</ul>
<p>示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mytable = &#123;&#125;                         <span class="comment">-- 普通表</span></span><br><span class="line">mymetatable = &#123;&#125;                     <span class="comment">-- 元表</span></span><br><span class="line"><span class="built_in">setmetatable</span>(mytable, mymetatable)   <span class="comment">-- 把 mymetatable 设为 mytable 的元素</span></span><br></pre></td></tr></table></figure>

<p>以上代码也可以直接写成一行：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mytable = <span class="built_in">setmetatable</span>(&#123;&#125;, &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 返回 mymetatable</span></span><br><span class="line"><span class="built_in">getmetatable</span>(mytable)</span><br></pre></td></tr></table></figure>

<h3 id="index-元方法"><a href="#index-元方法" class="headerlink" title="__index 元方法"></a>__index 元方法</h3><h4 id="index-包含表table示例"><a href="#index-包含表table示例" class="headerlink" title="__index 包含表table示例"></a>__index 包含表table示例</h4><p>这是 metatable 最常用的键。<br>当你通过键来访问 table 的时候，如果这个键没有值，那么Lua就会寻找该table的metatable(假设有metatable)中的<code>__index</code>键。<br>如果 <code>__index</code> 包含一个表格，Lua 会在表格中查找相应的键。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">other = &#123; foo = <span class="number">3</span> &#125;</span><br><span class="line">t = <span class="built_in">setmetatable</span>(&#123;&#125;, &#123; <span class="built_in">__index</span> = other &#125;)</span><br><span class="line">t.foo</span><br><span class="line"><span class="comment">-- 值为3</span></span><br></pre></td></tr></table></figure>

<p>解析：通过键foo访问table，就寻找表t的元表的<code>__index</code>键,存在 <code>__index</code> 且包含一个表格other，则在other表中查找对应的foo键，找到值为3.</p>
<h4 id="index-包含函数示例"><a href="#index-包含函数示例" class="headerlink" title="__index 包含函数示例"></a>__index 包含函数示例</h4><p><strong>如果 <code>__index</code> 包含一个函数的话，Lua 就会调用那个函数， table 和 “键”会作为参数传递给函数。</strong><br><code>__index</code> 元方法查看表中元素是否存在，如果不存在，返回结果为 nil；如果存在则由 <code>__index</code> 返回结果。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mytable = <span class="built_in">setmetatable</span>(&#123;key1 = <span class="string">&quot;value1&quot;</span>&#125;, &#123;</span><br><span class="line">    <span class="built_in">__index</span> = <span class="function"><span class="keyword">function</span><span class="params">(mytable, key)</span></span></span><br><span class="line">                    <span class="keyword">if</span> key == <span class="string">&quot;key2&quot;</span> <span class="keyword">then</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&quot;metatablevalue&quot;</span></span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(mytable.key1, mytable.key2, mytable.key3)</span><br><span class="line"><span class="comment">-- 输出结果为：</span></span><br><span class="line">val1    val2    <span class="literal">nil</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>给表 mytable 亦即 {key1 &#x3D; “value1”}，设置了元方法 __index 指向一个函数，如果传入key为key2的话，返回value2，这样类似增加了 key2&#x3D;value2，<br>使得 mytable &#x3D; {key1 &#x3D; “value1”, key2 &#x3D; “value2”}</strong></p>
<p>解析如下：</p>
<ul>
<li>mytable 赋值为 <strong>{key1&#x3D;”value1”}</strong></li>
<li>mytable 设置了元素，元方法为 __index</li>
<li>在 mytable 中查找 key1，如果找到，返回该元素，找不到则继续</li>
<li>在 mytable 中查找 key2，如果找到，返回 metatablevalue，找不到则继续</li>
<li>判断表有没有  <code>__index方法</code>，如果 <code>__index</code>方法是一个函数，则调用该函数</li>
<li>元方法中查看是否传入了 “key2” 键的参数(mytable.key2已设置)，如果传入”key2” 参数返回”metatablevalue”,否则返回mytable对应的键值。</li>
</ul>
<p>上述使用函数的可以改写为使用表table：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mytable = <span class="built_in">setmetatable</span>(&#123;key1=<span class="string">&quot;key1&quot;</span>&#125;, <span class="built_in">__index</span> = &#123;key2=<span class="string">&quot;metatablevalue&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(mytable.key1, mytable.key2)</span><br></pre></td></tr></table></figure>

<p><strong>总结</strong></p>
<p>Lua 查找一个表元素时的规则，其实就是如下三个步骤：</p>
<ul>
<li>在表中查找，如果找到，返回该元素，找不到则继续。</li>
<li>判断该表是否有元素，如果没有元素，返回nil，有元素则继续。</li>
<li>判断元素有没有 __index 方法， 如果 __index 方法为nil， 则返回nil；如果 __index 方法是一个表，则重复1、2、3；如果 __index 方法是一个函数，则返回该函数的返回值。</li>
</ul>
<h3 id="newindex-元方法"><a href="#newindex-元方法" class="headerlink" title="__newindex 元方法"></a>__newindex 元方法</h3><p><strong>__newindex 元方法用来对表更新， __index 则用来对表访问。</strong><br>当你给表的一个缺少的索引赋值，解释器就会查找 __newindex 元方法；如果存在则调用这个函数而不进行赋值操作。<br>示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mymetatable = &#123;&#125;</span><br><span class="line">mytable = <span class="built_in">setmetatable</span>(&#123;key1=<span class="string">&quot;value1&quot;</span>&#125;, &#123;<span class="built_in">__newindex</span>=mymetatable&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(mytable.key1)</span><br><span class="line"></span><br><span class="line">&gt; mytable.newkey = <span class="string">&quot;新值2&quot;</span></span><br><span class="line">&gt; <span class="built_in">print</span>(mytable.newkey, mymetatable.newkey)</span><br><span class="line"><span class="literal">nil</span>     新值<span class="number">2</span></span><br><span class="line">&gt; mytable.key1 = <span class="string">&quot;新值1&quot;</span></span><br><span class="line">&gt; <span class="built_in">print</span>(mytable.key1, mymetatable.key1)</span><br></pre></td></tr></table></figure>

<p>上述示例：给表设置了元方法 <code>__newindex</code>，在对新索引键（newkey）赋值时（mytable.newkey&#x3D;”新值2”），会调用元方法，而不进行赋值。<br>而如果对已存在的索引键（key1），则会进行赋值，而不调用元方法 <code>__newindex</code>。</p>
<h3 id="给表添加操作符"><a href="#给表添加操作符" class="headerlink" title="给表添加操作符"></a>给表添加操作符</h3><p>演示为2个表添加相加操作：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 计算表中最大值， table.maxn 在 Lua5.2以上版本中已无法使用</span></span><br><span class="line"><span class="comment">-- 自定义计算表中最大键值函数 table_maxen,即计算表的元素个数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">table_maxn</span><span class="params">(t)</span></span></span><br><span class="line">    <span class="keyword">local</span> mn = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(t) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> mn &lt; k <span class="keyword">then</span></span><br><span class="line">            mn = k</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> mn</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 两表相加操作</span></span><br><span class="line">mytable = <span class="built_in">setmetatable</span>(&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;, &#123;</span><br><span class="line">    <span class="built_in">__add</span> = <span class="function"><span class="keyword">function</span><span class="params">(firstable, secondtable)</span></span></span><br><span class="line">            <span class="keyword">for</span> i = <span class="number">1</span>, table_maxn(secondtable) <span class="keyword">do</span></span><br><span class="line">                <span class="built_in">table</span>.<span class="built_in">insert</span>(firstable, table_maxn(firstable)+<span class="number">1</span>, secondtable[i])</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">return</span> firstable</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">secondtable = &#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;</span><br><span class="line"></span><br><span class="line">mytable = mytable + secondtable</span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(mytable) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(k, v)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>__add 键包含在元素中，并进行相加操作。表中对应的操作列表如下：</p>
<table>
<thead>
<tr>
<th>模式</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>__add</td>
<td>对应的运算符’+’</td>
</tr>
<tr>
<td>__sub</td>
<td>对应的运算符’-‘</td>
</tr>
<tr>
<td>__mul</td>
<td>对应的运算符’*’</td>
</tr>
<tr>
<td>__div</td>
<td>对应的操作符’&#x2F;‘</td>
</tr>
<tr>
<td>__mod</td>
<td>对应运算符’%’</td>
</tr>
<tr>
<td>__concat</td>
<td>对应连接符’…’</td>
</tr>
<tr>
<td>__eq</td>
<td>对应’&#x3D;&#x3D;’</td>
</tr>
<tr>
<td>__lt</td>
<td>对应’&lt;’</td>
</tr>
<tr>
<td>__le</td>
<td>对应’&lt;&#x3D;’</td>
</tr>
<tr>
<td>__unm</td>
<td>对应负号’-‘</td>
</tr>
</tbody></table>
<h3 id="call-元方法"><a href="#call-元方法" class="headerlink" title="__call 元方法"></a>__call 元方法</h3><p>__call 元方法在Lua调用一个值时调用。<br>演示计算表中元素的和：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">table_maxn</span><span class="params">(t)</span></span></span><br><span class="line">    <span class="keyword">local</span> mn = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(t) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> mn &lt; k <span class="keyword">then</span></span><br><span class="line">            mn = k</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> mn</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 定义元方法__call</span></span><br><span class="line">mytable = <span class="built_in">setmetatable</span>(&#123;<span class="number">10</span>&#125;, &#123;</span><br><span class="line">  <span class="built_in">__call</span> = <span class="function"><span class="keyword">function</span><span class="params">(mytable, newtable)</span></span></span><br><span class="line">    sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span>, table_maxn(mytable) <span class="keyword">do</span></span><br><span class="line">        sum = sum + mytable[i]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span>, table_maxn(newtable) <span class="keyword">do</span></span><br><span class="line">        sum = sum + newtable[i]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">newtable = &#123;<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(mytable(newtable))</span><br><span class="line"><span class="comment">-- 输出：</span></span><br><span class="line"><span class="number">70</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="tostring-元方法"><a href="#tostring-元方法" class="headerlink" title="__tostring 元方法"></a>__tostring 元方法</h3><p>__tostring 元方法用于修改表的输出行为。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mytable = <span class="built_in">setmetatable</span>(&#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>&#125;, &#123;</span><br><span class="line">    <span class="built_in">__tostring</span> = <span class="function"><span class="keyword">function</span><span class="params">(mytable)</span></span></span><br><span class="line">            sum = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(mytable) <span class="keyword">do</span></span><br><span class="line">                sum = sum + v</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;表所有元素之和为:&quot;</span> ... sum</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 直接打印表，则调用其tostring方法</span></span><br><span class="line"><span class="built_in">print</span>(mytable)</span><br><span class="line"><span class="comment">-- 输出：</span></span><br><span class="line">表所有元素的和为 <span class="number">60</span></span><br></pre></td></tr></table></figure>

<p><strong>总结</strong>： 元表可以很好的简化代码功能，了解元表，可以写出更加简洁优秀的Lua代码。</p>
<h1 id="Lua-编程高级"><a href="#Lua-编程高级" class="headerlink" title="Lua 编程高级"></a>Lua 编程高级</h1><h2 id="Lua-协同程序-coroutine"><a href="#Lua-协同程序-coroutine" class="headerlink" title="Lua 协同程序(coroutine)"></a>Lua 协同程序(coroutine)</h2><h3 id="什么是协同-coroutine"><a href="#什么是协同-coroutine" class="headerlink" title="什么是协同(coroutine)?"></a>什么是协同(coroutine)?</h3><p>Lua 协同程序coroutine与线程比较类似：拥有独立的堆栈、独立的局部变量，独立的指令指针，同时又与其他协同程序共享全局变量和其他大部分资源。<br>协同是非常强大的功能，但是用起来也很复杂。</p>
<h4 id="线程和协同程序的区别"><a href="#线程和协同程序的区别" class="headerlink" title="线程和协同程序的区别"></a>线程和协同程序的区别</h4><p>线程与协同程序的主要区别在于，一个具有多个线程的程序可以同时运行几个线程，而协同程序却需要彼此协作的运行。<br>在任意时刻只有一个协同程序在运行，并且这个正在运行的程序只有在摩纳哥却的被要求挂起的时候才会被挂起。<br>协同程序有点类似同步的多线程，在等待同一个线程锁的几个线程类似协同程序。</p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>coroutine.create()</td>
<td>创建coroutine，参数是一个函数，当和resume配合使用的时候就唤醒函数调用</td>
</tr>
<tr>
<td>coroutine.resume()</td>
<td>重启coroutine，和create配合使用</td>
</tr>
<tr>
<td>coroutine.yield()</td>
<td>挂起coroutine，将coroutine设置为挂起状态，这个和resume配合使用可以产生很多效果</td>
</tr>
<tr>
<td>coroutine.status()</td>
<td>查看coroutine的状态：dead,suspend,running</td>
</tr>
<tr>
<td>coroutine.wrap()</td>
<td>创建coroutine，返回一个函数，一旦你调用这个函数，就进入coroutine，和create功能重复</td>
</tr>
<tr>
<td>coroutine.sunning()</td>
<td>返回正在跑的coroutine，一个coroutine就是一个线程，当使用sunning的时候，就是返回一个coroutine的线程号</td>
</tr>
</tbody></table>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- coroutine_test.lua 文件</span></span><br><span class="line">co = <span class="built_in">coroutine</span>.<span class="built_in">create</span>(</span><br><span class="line">        <span class="function"><span class="keyword">function</span><span class="params">(i)</span></span></span><br><span class="line">            <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">coroutine</span>.<span class="built_in">status</span>(co)) <span class="comment">--susoend</span></span><br><span class="line"><span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co, <span class="number">1</span>)     <span class="comment">-- 1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">coroutine</span>.<span class="built_in">status</span>(co))  <span class="comment">-- dead</span></span><br><span class="line"></span><br><span class="line">co = <span class="built_in">coroutine</span>.<span class="built_in">wrap</span>(</span><br><span class="line">    <span class="function"><span class="keyword">function</span><span class="params">(i)</span></span></span><br><span class="line">        <span class="built_in">print</span>(i);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line">co(<span class="number">1</span>)  <span class="comment">-- 1</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co2) </span><br><span class="line"><span class="number">1</span></span><br><span class="line">&gt; <span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co2) </span><br><span class="line"><span class="number">2</span></span><br><span class="line">&gt; <span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co2) </span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="built_in">running</span></span><br><span class="line">thread: <span class="number">0x6a40c0</span></span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="built_in">coroutine</span>.<span class="built_in">status</span>(co2))</span><br><span class="line">suspended</span><br></pre></td></tr></table></figure>
<p>从coroutine.running()的输出可以看出，coroutine在底层实现就是一个线程。</p>
<p>当create一个coroutine的时候就是在新线程中注册了一个事件。<br>当使用resume触发事件的时候，create的coroutine函数就被执行了，当遇到yield的时候就代表挂起当前线程，等候再次resume触发事件。<br>示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> <span class="params">(a)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;foo 函数输出&quot;</span>, a)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">coroutine</span>.<span class="built_in">yield</span>(<span class="number">2</span> * a) <span class="comment">-- 返回  2*a 的值</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line">co = <span class="built_in">coroutine</span>.<span class="built_in">create</span>(<span class="function"><span class="keyword">function</span> <span class="params">(a , b)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;第一次协同程序执行输出&quot;</span>, a, b) <span class="comment">-- co-body 1 10</span></span><br><span class="line">    <span class="keyword">local</span> r = foo(a + <span class="number">1</span>)</span><br><span class="line">     </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;第二次协同程序执行输出&quot;</span>, r)</span><br><span class="line">    <span class="keyword">local</span> r, s = <span class="built_in">coroutine</span>.<span class="built_in">yield</span>(a + b, a - b)  <span class="comment">-- a，b的值为第一次调用协同程序时传入</span></span><br><span class="line">     </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;第三次协同程序执行输出&quot;</span>, r, s)</span><br><span class="line">    <span class="keyword">return</span> b, <span class="string">&quot;结束协同程序&quot;</span>                   <span class="comment">-- b的值为第二次调用协同程序时传入</span></span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;main&quot;</span>, <span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co, <span class="number">1</span>, <span class="number">10</span>)) </span><br><span class="line"><span class="comment">-- 传入a，b分别值分别为1，10；调用foo函数传入参数为2，协同程序在foo里面调用yield挂起，返回4.</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;--分割线----&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;main&quot;</span>, <span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co, <span class="string">&quot;r&quot;</span>)) <span class="comment">-- true 11 -9</span></span><br><span class="line"><span class="comment">-- 第二次重启协同程序传入字符串&quot;r&quot;参数，挂起传入参为 1+10; 1-10</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;---分割线---&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;main&quot;</span>, <span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>)) <span class="comment">-- true 10 end</span></span><br><span class="line"><span class="comment">-- 第三次重启，输出第三次执行输出的内容。结束协同程序。</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;---分割线---&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;main&quot;</span>, <span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>)) <span class="comment">-- cannot resume dead coroutine</span></span><br><span class="line"><span class="comment">-- 协同程序已经终止，无法再次启动</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;---分割线---&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--输出：</span></span><br><span class="line">第一次协同程序执行输出    <span class="number">1</span>    <span class="number">10</span></span><br><span class="line">foo 函数输出    <span class="number">2</span></span><br><span class="line">main    <span class="literal">true</span>    <span class="number">4</span></span><br><span class="line"><span class="comment">--分割线----</span></span><br><span class="line">第二次协同程序执行输出    r</span><br><span class="line">main    <span class="literal">true</span>    <span class="number">11</span>    <span class="number">-9</span></span><br><span class="line"><span class="comment">---分割线---</span></span><br><span class="line">第三次协同程序执行输出    x    y</span><br><span class="line">main    <span class="literal">true</span>    <span class="number">10</span>    结束协同程序</span><br><span class="line"><span class="comment">---分割线---</span></span><br><span class="line">main    <span class="literal">false</span>    cannot <span class="built_in">resume</span> dead <span class="built_in">coroutine</span></span><br><span class="line"><span class="comment">---分割线---</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>调用resume，将协同程序唤醒，resume操作成功返回true，否则返回false。</li>
<li>协同程序运行</li>
<li>运行到yield语句</li>
<li>yield挂起协同程序，第一次resume返回；（注意：此处yield返回，参数是resume的参数）</li>
<li>第二次resume，再次唤醒协同程序；（注意：此处resume参数中，除了第一个参数，剩下的参数作为yield的参数）</li>
<li>yield返回</li>
<li>协同程序继续运行</li>
<li>如果使用的协同程序继续运行完成后继续调用resume方法则输出：cannot resume dead coroutine</li>
</ul>
<p>resume 和 yield 的配合强大之处在于， resume处于主程中，它将外部状态（数据）传入到协同程序内部；而 yield 则将内部的状态（数据）返回到主程中。</p>
<h3 id="生产者-消费者问题"><a href="#生产者-消费者问题" class="headerlink" title="生产者-消费者问题"></a>生产者-消费者问题</h3><p>使用 Lua 协同程序来完成 生产者-消费者 模式。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> new Productor</span><br><span class="line"></span><br><span class="line">- 定义生产者</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">productor</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">        i = i + <span class="number">1</span></span><br><span class="line">        send(i)  <span class="comment">-- 将生产的消息发送给消费者</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 定义消费者</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">consumer</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> i = receive()</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">receive</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> <span class="built_in">status</span>, value = <span class="built_in">coroutine</span>.<span class="built_in">resume</span>(newProductor)</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">(x)</span></span></span><br><span class="line">    <span class="built_in">coroutine</span>.<span class="built_in">yield</span>(x)  <span class="comment">--发送x，值返回后，挂起该协同程序</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 启动程序</span></span><br><span class="line">newProductor = <span class="built_in">coroutine</span>.<span class="built_in">create</span>(productor) <span class="comment">-- 使用生产函数创建一个协同程序</span></span><br><span class="line">consumer() <span class="comment">--启动消费</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="Lua-文件-IO"><a href="#Lua-文件-IO" class="headerlink" title="Lua 文件 IO"></a>Lua 文件 IO</h2><p>Lua I&#x2F;O 库用于读写文件。 分为简单模式(和C一样)、完全模式。</p>
<ul>
<li>简单模式： 拥有一个当前输入文件和一个当前输出文件，并且提供针对这些文件相关的操作。</li>
<li>完全模式： 使用外部的文件句柄来实现。他以一种面向对象的形式，将所有的文件操作定义为文件句柄的方法。</li>
</ul>
<p>简单模式在做一些简单的文件操作时较为合适。但是在进行一些高级的文件操作的时候，简单模式就显得力不从心。<br>例如同时读取多个文件这样的操作，使用完全模式较为合适。</p>
<p>打开文件操作语句如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(filename [, mode])</span><br></pre></td></tr></table></figure>

<p>mode 的值有：</p>
<table>
<thead>
<tr>
<th>模式</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>r</td>
<td>以只读方式打开文件，该文件必须存在</td>
</tr>
<tr>
<td>w</td>
<td>打开只写文件，若文件存在则文件长度清为0，即该文件内容会消失。若文件不存在则建立该文件</td>
</tr>
<tr>
<td>a</td>
<td>以附加的方式打开只写文件。若文件不存在则建立该文件，如果文件存在，则写入的数据会被追加到文件末尾，即文件原来的内容会被保留。（EOF保留）</td>
</tr>
<tr>
<td>r+</td>
<td>以可读写方式打开文件，该文件必须存在</td>
</tr>
<tr>
<td>w+</td>
<td>打开可读写文件，若文件存在则清零，不存在则建立该文件</td>
</tr>
<tr>
<td>a+</td>
<td>与a类似，但此文件可读可写</td>
</tr>
<tr>
<td>b</td>
<td>二进制模式，如果文件是二进制文件，可以加上b</td>
</tr>
<tr>
<td>+</td>
<td>表示对文件可读也可写</td>
</tr>
</tbody></table>
<h3 id="简单模式"><a href="#简单模式" class="headerlink" title="简单模式"></a>简单模式</h3><p>简单模式使用标准的 I&#x2F;O 或使用一个当前输入文件和一个当前输出文件。<br>创建一个 test.lua 文件。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 以只读方式打开文件</span></span><br><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&quot;test.lua&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置默认输入文件为 test.lua; 对文件进行 I/O操作前，需要将其设置为输入文件</span></span><br><span class="line"><span class="built_in">io</span>.<span class="built_in">input</span>(file)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 输出文件第一行</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">io</span>.<span class="built_in">read</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭打开的文件</span></span><br><span class="line"><span class="built_in">io</span>.<span class="built_in">close</span>(file)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 以附加的方式打开只写文件</span></span><br><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&quot;test.lua&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置默认输出文件为 test.lua</span></span><br><span class="line"><span class="built_in">io</span>.<span class="built_in">output</span>(file)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在文件最后一行添加 Lua 注释  -- write会返回写入的内容</span></span><br><span class="line"><span class="built_in">io</span>.<span class="built_in">write</span>(<span class="string">&quot;--  test.lua 文件末尾注释&quot;</span>)    </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭打开的文件</span></span><br><span class="line"><span class="built_in">io</span>.<span class="built_in">close</span>(file)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>输出：<br>&#96;&#96;&#96;–  test.lua 文件末尾注释&#96;&#96;&#96;&#96;&#96;</p>
<p>在以上示例使用了 io.”x” 方法，其中 io.read() 方法我们没有带参数，参数可以是下表中的一个：</p>
<table>
<thead>
<tr>
<th>模式</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>“n”</td>
<td>读取一个数字并返回它。例如 file.read(“n”)</td>
</tr>
<tr>
<td>“*a”</td>
<td>从当前位置读取整个文件。例如 file.read(“*a”)</td>
</tr>
<tr>
<td>“*l”</td>
<td>默认。读取下一行，在文件末尾（EOF）处返回nil。例如： file.read(“*l”)</td>
</tr>
<tr>
<td>number</td>
<td>返回一个指定字符个数的字符串，或者在EOF时返回nil。例如： file.read(5)</td>
</tr>
</tbody></table>
<p>其他的IO方法有：</p>
<ul>
<li><strong>io.tmpfile()</strong> : 返回一个临时文件句柄，该文件以更新模式打开，程序结束时自动删除。</li>
<li><strong>io.type(file)</strong> ： 检测io是否一个可用的文件句柄</li>
<li><strong>io.flush()</strong> ： 向文件写入缓冲中的所有数据</li>
<li><strong>io.lines(optional file name)</strong> ： 返回一个迭代函数，每次调用将获得文件中的一行内容，当到文件尾时，将返回nil，但不关闭文件。</li>
</ul>
<h3 id="完全模式"><a href="#完全模式" class="headerlink" title="完全模式"></a>完全模式</h3><p>通常我们需要在同一时间处理多个文件。我们需要使用 file:funcname 来代替 io.funcname 方法。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&quot;test.lua&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(file:<span class="built_in">read</span>())</span><br><span class="line"></span><br><span class="line">file:<span class="built_in">close</span>()</span><br><span class="line"></span><br><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&quot;test.lua&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line">file:<span class="built_in">write</span>(<span class="string">&quot;--test&quot;</span>)</span><br><span class="line"></span><br><span class="line">file:<span class="built_in">close</span>()</span><br></pre></td></tr></table></figure>

<p>其他方法：</p>
<ul>
<li><p>file:seek(optional whence, optional offset) : 设置和获取当前文件位置，成功则返回最终的文件位置（按字节），失败则返回nil加错误信息。<br>参数whence的值可以是：</p>
<ul>
<li>“set” : 从文件头开始</li>
<li>“cur” : 从当前位置开始（默认）</li>
<li>“end” : 从文件末尾开始</li>
<li>“offset” : 默认为0</li>
</ul>
<p>  不带参数 file:seek() 则返回当前位置，file:seek(“set”)则定为到文件头，file:seek(“end”)则定为文件末尾并返回文件大小。</p>
</li>
<li><p>file:flush() ： 向文件写入缓冲中的所有数据</p>
</li>
<li><p>io.lines(optional file name) : 打开指定的文件filename为读模式并返回一个迭代函数，每次调用将获得文件中的一行内容，当到文件末尾时，将返回nil，并自动关闭文件。<br> 若不带参数时io.lines() &lt;&#x3D;&gt; io.input():lines(); 读取默认输入设备的内容，但结束时不关闭文件，如：</p>
</li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">io</span>.<span class="built_in">lines</span>(<span class="string">&quot;test.lua&quot;</span>) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(line)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>以下示例使用了seek方法，定位到文件倒数第25个位置并使用read方法的*a参数，即从当前位置（倒数第25个位置）读取整个文件。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&quot;test.lua&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line"></span><br><span class="line">file:seek(<span class="string">&quot;end&quot;</span>, <span class="number">-25</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(file:<span class="built_in">read</span>(<span class="string">&quot;*a&quot;</span>))</span><br><span class="line"></span><br><span class="line">file:<span class="built_in">close</span>()</span><br></pre></td></tr></table></figure>


<h2 id="Lua-错误处理机制"><a href="#Lua-错误处理机制" class="headerlink" title="Lua 错误处理机制"></a>Lua 错误处理机制</h2><p>程序运行中错误处理是很有必要的，在我们进行文件操作，数据转移以及web service 调用过程中都会出现不可预期的错误。<br>如果不注重错误信息的处理，就会造成信息泄露，程序无法运行等情况。<br>任何语言，都需要进行错误处理，错误类型分为：</p>
<ul>
<li>语法错误</li>
<li>运行错误</li>
</ul>
<h3 id="语法错误"><a href="#语法错误" class="headerlink" title="语法错误"></a>语法错误</h3><p>语法错误通常是由于对程序组件（如运算符、表达式、函数等）使用不当导致的，一个简单示例如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a ==<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>执行结果为： </p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">stdin</span>:<span class="number">1</span>: <span class="string">&#x27;=&#x27;</span> expected near <span class="string">&#x27;==&#x27;</span></span><br></pre></td></tr></table></figure>

<p>另一个示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> a= <span class="number">1</span>,<span class="number">10</span></span><br><span class="line">   <span class="built_in">print</span>(a)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提示错误如下：</span></span><br><span class="line"><span class="built_in">stdin</span>:<span class="number">2</span>: <span class="string">&#x27;do&#x27;</span> expected near <span class="string">&#x27;print&#x27;</span></span><br></pre></td></tr></table></figure>

<p>语法错误比程序运行错误更简单，语法错误可以很快解决，上述示例提示在print之前需要加上do。</p>
<h3 id="运行错误"><a href="#运行错误" class="headerlink" title="运行错误"></a>运行错误</h3><p>运行错误是程序可以正常执行，但是会输出报错信息，如下参数输入错误，程序执行时报错：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(a, b)</span></span></span><br><span class="line">    <span class="keyword">return</span> a+b</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><p>Lua 中可以使用两个函数 ： <strong>assert</strong> 和 <strong>error</strong> 来处理错误，如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(a, b)</span></span></span><br><span class="line">    <span class="built_in">assert</span>(<span class="built_in">type</span>(a) == <span class="string">&quot;number&quot;</span>, <span class="string">&quot;a 不是一个数字&quot;</span>)</span><br><span class="line">    <span class="built_in">assert</span>(<span class="built_in">type</span>(b) == <span class="string">&quot;number&quot;</span>, <span class="string">&quot;b 不是一个数字&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> a+b</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">&gt; add(<span class="number">10</span>)</span><br><span class="line"><span class="built_in">stdin</span>:<span class="number">3</span>: b 不是一个数字</span><br><span class="line">stack <span class="built_in">traceback</span>:</span><br><span class="line">        [C]: <span class="keyword">in</span> <span class="function"><span class="keyword">function</span> &#x27;<span class="title">assert</span>&#x27;</span></span><br><span class="line"><span class="function">        <span class="title">stdin</span>:3: <span class="title">in</span> <span class="title">function</span> &#x27;<span class="title">add</span>&#x27;</span></span><br><span class="line"><span class="function">        <span class="title">stdin</span>:1: <span class="title">in</span> <span class="title">main</span> <span class="title">chunk</span></span></span><br><span class="line"><span class="function">        [<span class="title">C</span>]: ?</span></span><br></pre></td></tr></table></figure>

<p>示例中 assert 首先检查第一个参数，没有问题则不做任何事情；<br>否则检查第二个参数，错误则输出错误信息。</p>
<h3 id="error-函数"><a href="#error-函数" class="headerlink" title="error 函数"></a>error 函数</h3><p>语法格式：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">error</span> (message [, level])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>功能： 终止正在执行的函数，并返回message的内容作为错误信息（error函数永远都不会返回）<br>通常情况下，error会附加一些错误位置的信息到message头部。<br>level参数指示获得错误的位置：</p>
<ul>
<li>level &#x3D; 1(默认)：为调用error位置（文件+行号）</li>
<li>level &#x3D; 2：指出哪个调用error的函数的函数</li>
<li>leve &#x3D; 0：不添加错误位置信息</li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(a, b)</span></span></span><br><span class="line">    <span class="built_in">error</span>(<span class="string">&quot;错误信息&quot;</span>, b)    </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; add(b)</span><br><span class="line"><span class="built_in">stdin</span>:<span class="number">2</span>: 错误信息</span><br><span class="line">stack <span class="built_in">traceback</span>:</span><br><span class="line">        [C]: <span class="keyword">in</span> <span class="function"><span class="keyword">function</span> &#x27;<span class="title">error</span>&#x27;</span></span><br><span class="line"><span class="function">        <span class="title">stdin</span>:2: <span class="title">in</span> <span class="title">function</span> &#x27;<span class="title">add</span>&#x27;</span></span><br><span class="line"><span class="function">        <span class="title">stdin</span>:1: <span class="title">in</span> <span class="title">main</span> <span class="title">chunk</span></span></span><br><span class="line"><span class="function">        [<span class="title">C</span>]: ?</span></span><br></pre></td></tr></table></figure>

<h3 id="pcall-和-xpcall、debug"><a href="#pcall-和-xpcall、debug" class="headerlink" title="pcall 和 xpcall、debug"></a>pcall 和 xpcall、debug</h3><p>Lua 中处理错误，可以使用函数pcall（protected call）来包装需要执行的代码。<br>pcall 接收一个函数和要传递给后者的参数，并执行，执行结果：有错误、无错误；返回值true或者false，errorinfo。</p>
<p>语法格式如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">pcall</span>(funcname, ...) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">--没有错误</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="comment">-- 一些错误</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>示例如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; = <span class="built_in">pcall</span>(<span class="function"><span class="keyword">function</span><span class="params">(i)</span></span></span><br><span class="line">    <span class="built_in">print</span>(i)  <span class="built_in">error</span>(<span class="string">&quot;错误信息...&quot;</span>)</span><br><span class="line">    <span class="keyword">end</span>, <span class="number">33</span>)</span><br><span class="line"><span class="number">33</span></span><br><span class="line"><span class="literal">false</span>   <span class="built_in">stdin</span>:<span class="number">2</span>: 错误信息...</span><br></pre></td></tr></table></figure>

<p>pcall 以一种“保护模式”来调用第一个参数，因此pcall可以捕获函数执行中的任何错误。<br>通常在错误发生时，希望罗德更多的调试信息，而不只是发生错误的位置，但 pcall 返回时，他已经销毁了调用栈的部分内容。</p>
<p>Lua提供了xpcall函数，xpcall接收第二个参数———— 一个错误处理函数，当错误发生的时候，Lua会在调用栈展开(unwind)前调用错误处理函数，于是就可以在这个函数中使用debug库来获取关于错误的额外信息了。<br>debug库提供了两个通用的错误处理函数：</p>
<ul>
<li>debug.debug : 提供一个Lua提示符，让用户来检查错误的原因</li>
<li>debug.traceback: 根据调用栈来构建一个扩展的错误信息</li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; =<span class="built_in">xpcall</span>(<span class="function"><span class="keyword">function</span><span class="params">(i)</span></span> <span class="built_in">print</span>(i) <span class="built_in">error</span>(<span class="string">&#x27;error..&#x27;</span>) <span class="keyword">end</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="built_in">print</span>(<span class="built_in">debug</span>.<span class="built_in">traceback</span>()) <span class="keyword">end</span>, <span class="number">33</span>)</span><br><span class="line"><span class="literal">nil</span></span><br><span class="line">stack <span class="built_in">traceback</span>:</span><br><span class="line">        <span class="built_in">stdin</span>:<span class="number">1</span>: <span class="keyword">in</span> <span class="function"><span class="keyword">function</span> &lt;<span class="title">stdin</span>:1&gt;</span></span><br><span class="line"><span class="function">        [<span class="title">C</span>]: <span class="title">in</span> <span class="title">function</span> &#x27;<span class="title">error</span>&#x27;</span></span><br><span class="line"><span class="function">        <span class="title">stdin</span>:1: <span class="title">in</span> <span class="title">function</span> &lt;<span class="title">stdin</span>:1&gt;</span></span><br><span class="line"><span class="function">        [<span class="title">C</span>]: <span class="title">in</span> <span class="title">function</span> &#x27;<span class="title">xpcall</span>&#x27;</span></span><br><span class="line"><span class="function">        <span class="title">stdin</span>:1: <span class="title">in</span> <span class="title">main</span> <span class="title">chunk</span></span></span><br><span class="line"><span class="function">        [<span class="title">C</span>]: ?</span></span><br><span class="line"><span class="function"><span class="title">false</span>   <span class="title">nil</span></span></span><br></pre></td></tr></table></figure>

<p>xpcall使用示例1：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myfunction</span> <span class="params">()</span></span></span><br><span class="line">   n = n/<span class="literal">nil</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myerrorhandler</span><span class="params">( err )</span></span></span><br><span class="line">   <span class="built_in">print</span>( <span class="string">&quot;ERROR:&quot;</span>, err )</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">status</span> = <span class="built_in">xpcall</span>( myfunction, myerrorhandler )</span><br><span class="line"><span class="built_in">print</span>( <span class="built_in">status</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 输出:</span></span><br><span class="line">ERROR:  <span class="built_in">stdin</span>:<span class="number">2</span>: attempt to perform arithmetic on global <span class="string">&#x27;n&#x27;</span> (a <span class="literal">nil</span> value)</span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h2 id="Lua-调试"><a href="#Lua-调试" class="headerlink" title="Lua 调试"></a>Lua 调试</h2><p>Lua 提供了debug库用于提供创建我们自定义调试器的功能。Lua 本身并没有内置的调试器，但是很多开发者共享了它们的Lua调试器代码。<br>Lua 中debug库包含以下函数：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>debug()</td>
<td>进入一个用户交互模式，运行用户输入的每个字符串。使用简单的命令以及其他调试设置，用户可以检阅全局变量和局部变量，改变变量的值，计算一些表达式，等等。输入一行仅包含cont的字符串将结束这个函数，这样调用者就可以继续向下执行</td>
</tr>
<tr>
<td>getfenv(object)</td>
<td>返回对象的环境变量</td>
</tr>
<tr>
<td>gethook(optional thread)</td>
<td>返回三个表示线程钩子设置的值：当前钩子函数、当前钩子掩码、当前钩子计数</td>
</tr>
<tr>
<td>getinfo([thread,] f [,what])</td>
<td>返回一个函数信息的表。可以直接提供该函数，也可以用一个数字f表示函数。数字f表示运行在指定线程的调用栈对应层次上的函数：0层表示当前函数(getinfo自身)；1表示调用getinfo的函数（除非是尾调用，这种情况下不计入栈）；等等。如果f是一个比活动函数数量还大的数字，getinfo返回nil</td>
</tr>
<tr>
<td>debug.getlocal([thread,] f, local)</td>
<td>此函数返回在栈的f层处函数的索引为local的局部变量的名字和值。这个函数不仅用于访问显示定义的局部变量，也包括形参、临时变量等。</td>
</tr>
<tr>
<td>getmetatable(value)</td>
<td>把指定索引指向的值的元素压入堆栈。如果索引无效，或是这个值没有元素，函数将返回0并且不会向栈上压任何东西。</td>
</tr>
<tr>
<td>getregistry()</td>
<td>返回注册表，这是一个预定义出来的表，可以用来保存任何C代码想保存的Lua值</td>
</tr>
<tr>
<td>getupvalue(f, up)</td>
<td>此函数返回函数f的第up个上值得名字和值。如果该函数没有那个上值，返回nil。以’(‘开头得变量名表示没有名字得变量（去除了调试信息得代码块）</td>
</tr>
<tr>
<td>sethook([thread,] hook, mask [, count])</td>
<td>将一个函数作为钩子函数设入。字符串mask以及数字count决定了钩子在何时调用。掩码是由下列字符组合成得字符串，每个字符有其含义： ‘c’ : 每当Lua调用一个函数是，调用钩子; ‘r’ : 每当Lua从一个函数内返回时，调用钩子; ‘l’ : 每当Lua进入新的一行时，调用钩子</td>
</tr>
<tr>
<td>seylocal([thread,] level, local, value)</td>
<td>这个函数将value赋给栈上第level层函数的第local个局部变量。如果没有那个变量，函数返回nil。如果level越界，抛出一个错误。</td>
</tr>
<tr>
<td>setmetatable(value, table)</td>
<td>将value的元素设为table(可以是nil)。返回value</td>
</tr>
<tr>
<td>setupvalue(f, up, value)</td>
<td>这个函数将value设为函数f的第up个上值，如果函数没有那个上值，返回nil</td>
</tr>
<tr>
<td>traceback([thread,] [message [, level]])</td>
<td>如果message有，且不是字符串或nil，函数不做任何处理直接返回message。否则，它返回调用栈的栈回溯信息。字符串可选项message被添加在栈回溯信息的开头。数字可选项level指明从栈的哪一层开始回溯（默认为1，即调用traceback的那里）</td>
</tr>
</tbody></table>
<p>简单示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myfunction</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">debug</span>.<span class="built_in">traceback</span>(<span class="string">&quot;堆栈信息：&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">debug</span>.<span class="built_in">getinfo</span>(<span class="number">1</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;堆栈信息结束。&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">&gt; myfunction()</span><br><span class="line">堆栈信息：</span><br><span class="line">stack <span class="built_in">traceback</span>:</span><br><span class="line">        <span class="built_in">stdin</span>:<span class="number">2</span>: <span class="keyword">in</span> <span class="function"><span class="keyword">function</span> &#x27;<span class="title">myfunction</span>&#x27;</span></span><br><span class="line"><span class="function">        <span class="title">stdin</span>:1: <span class="title">in</span> <span class="title">main</span> <span class="title">chunk</span></span></span><br><span class="line"><span class="function">        [<span class="title">C</span>]: ?</span></span><br><span class="line"><span class="function"><span class="title">table</span>: 0<span class="title">x198dab0</span></span></span><br><span class="line"><span class="function">堆栈信息结束。</span></span><br><span class="line"><span class="function">&gt; <span class="title">print</span><span class="params">(debug.getinfo(1)</span></span>)</span><br><span class="line"><span class="built_in">table</span>: <span class="number">0x198e140</span></span><br></pre></td></tr></table></figure>


<h2 id="Lua-垃圾回收"><a href="#Lua-垃圾回收" class="headerlink" title="Lua 垃圾回收"></a>Lua 垃圾回收</h2><p>Lua 采用了自动内存管理。这意味着你不用操心新创建的对象需要的内存如何分配出来，也不用考虑在对象不再被使用后怎样释放它们所占用的内存。<br>Lua 运行了一个垃圾收集器来收集所有死对象（即在Lua中不能再访问到的对象）来完成自动内存管理的工作。Lua中所有用到的内存，如：字符串、表、用户数据、函数、线程、内部结构等，都服从内存管理。<br>Lua 实现了一个增量标记-扫描收集器。它使用这两个数字来控制垃圾收集循环：垃圾收集器间歇率和垃圾收集器步进倍率。这两个数字都使用百分数为单位（例如:值100在内部表示1）。</p>
<p>垃圾收集器间歇率控制着收集器需要在开启新的循环前要等待多久。增大这个值会减少收集器的积极性。当这个值比100小的时候，收集器在开始新的循环前不会有等待。设置这个值为200就会让收集器等到内存使用量达到之前的两倍时才开始新的循环。</p>
<p>垃圾收集器步进倍率控制着收集器运作速度相对于内存分配速度的倍率。增大这个值不仅会让收集器更加积极，还会增加每个增量步骤的长度。不要把这个值设的小于100，那样的话收集器就工作的太慢以至于干不完一个循环。默认值是200，表示收集器以内存分配的“两倍”速工作。</p>
<p>如果你把步进倍率设为一个非常大的数字 （比你的程序可能用到的字节数还大 10% ）， 收集器的行为就像一个 stop-the-world 收集器。 接着你若把间歇率设为 200 ， 收集器的行为就和过去的 Lua 版本一样了： 每次 Lua 使用的内存翻倍时，就做一次完整的收集。</p>
<h3 id="垃圾回收器函数"><a href="#垃圾回收器函数" class="headerlink" title="垃圾回收器函数"></a>垃圾回收器函数</h3><p>Lua 提供了一下函数 collectgarbage([opt [, arg]]) 用来控制自动内存管理。</p>
<ul>
<li>collectgarbage(“collect”) : 做一次完整的垃圾收集循环。通过参数opt它提供了一组不同的功能。</li>
<li>collectgarbage(“count”) : 以k字节数为单位返回 Lua 使用的总内存数。这个值有小数部分，所以只需要乘以1024就能得到Lua使用的准确字节数（除非溢出）</li>
<li>collectgarbage(“restart”) : 重启垃圾收集器的自动运行。</li>
<li>collectgarbage(“setpause”) : 将arg设为收集器的间歇率。返回间歇率的前一个值。</li>
<li>collectgarbage(“step”) : 单步运行垃圾收集器。步长“大小”由arg控制。传入0时，收集器步进（不可分割）一步。传入非0值，收集器相当于Lua分配这些多（k字节）内存的工作。如果收集器结束一个循环将返回true。</li>
<li>collectgarbage(“stop”) : 停止垃圾收集器的运行。在调用重启前，收集器只会因显式地调用运行。</li>
</ul>
<p>示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; mytable = &#123;<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;orange&quot;</span>, <span class="string">&quot;banana&quot;</span>&#125;</span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="built_in">collectgarbage</span>(<span class="string">&quot;count&quot;</span>))</span><br><span class="line"><span class="number">58.8583984375</span></span><br><span class="line">&gt; mytable = <span class="literal">nil</span></span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="built_in">collectgarbage</span>(<span class="string">&quot;count&quot;</span>))</span><br><span class="line"><span class="number">59.8076171875</span></span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="built_in">collectgarbage</span>(<span class="string">&quot;collect&quot;</span>))</span><br><span class="line"><span class="number">0</span></span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="built_in">collectgarbage</span>(<span class="string">&quot;count&quot;</span>))</span><br><span class="line"><span class="number">30.326171875</span></span><br></pre></td></tr></table></figure>

<h2 id="Lua-面向对象"><a href="#Lua-面向对象" class="headerlink" title="Lua 面向对象"></a>Lua 面向对象</h2><p>面向对象特征：</p>
<ul>
<li>封装： 指能够把一个实体的信息、功能、响应都装入一个单独地对象中的特性。</li>
<li>继承： 继承的方法允许在不改动源程序的基础上对其进行扩充，这样使得原功能得以保存，而新功能也得以扩展。这有利于减少重复编码，提高软件的开发效率。</li>
<li>多态： 同意操作作用不同的对象，实现不同的行为。</li>
<li>抽象： 简化复杂的现实问题。</li>
</ul>
<h3 id="Lua-中面向对象"><a href="#Lua-中面向对象" class="headerlink" title="Lua 中面向对象"></a>Lua 中面向对象</h3><p>Lua 中function可以用来表示方法。那么Lua中的类可以通过table+function模拟出来。<br>至于继承可以通过metatable模拟出来（不推荐用，只模拟最基本的对象大部分时间够用了）</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Account = &#123;balance = <span class="number">0</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Account.withdraw</span><span class="params">(v)</span></span></span><br><span class="line">    Account.balance = Account.balance - v</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>这个定义创建了一个新的函数，并且保存在Account对象的withdraw域内，可以这样调用：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Account.withdraw(<span class="number">100.00</span>)</span><br></pre></td></tr></table></figure>

<h4 id="一个简单示例"><a href="#一个简单示例" class="headerlink" title="一个简单示例"></a>一个简单示例</h4><p>以下简单示例包含了三个属性： area、length和breadth， printArea用于打印计算结果：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Meta Class</span></span><br><span class="line">Rectangle = &#123;area =<span class="number">0</span>, length = <span class="number">0</span>, breadth = <span class="number">0</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 派生类的方法 new</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Rectangle:new</span><span class="params">(o, length, breadth)</span></span></span><br><span class="line">    o = o <span class="keyword">or</span> &#123;&#125;</span><br><span class="line">    <span class="built_in">setmetatable</span>(o, <span class="built_in">self</span>)</span><br><span class="line">    <span class="built_in">self</span>.<span class="built_in">__index</span> = <span class="built_in">self</span></span><br><span class="line">    <span class="built_in">self</span>.length = length <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line">    <span class="built_in">self</span>.breadth = breadth <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line">    <span class="built_in">self</span>.area = length*breadth</span><br><span class="line">    <span class="keyword">return</span> o</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 派生类的方法 printArea</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Rectangle:printArea</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;矩形面积为：&quot;</span>, <span class="built_in">self</span>.area)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h4 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h4><p>创建对象是为类的实例分配内存的过程。每个类都有属于自己的内存并共享公共数据。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r = Rectangle:new(<span class="literal">nil</span>, <span class="number">10</span>, <span class="number">20</span>)</span><br></pre></td></tr></table></figure>
<h4 id="访问属性"><a href="#访问属性" class="headerlink" title="访问属性"></a>访问属性</h4><p>可以使用点符.来访问类的属性：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(r.length)</span><br></pre></td></tr></table></figure>

<h4 id="访问成员函数"><a href="#访问成员函数" class="headerlink" title="访问成员函数"></a>访问成员函数</h4><p>我们可以使用冒号：来访问类的成员函数：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; r:printArea()</span><br><span class="line">矩形面积为：    <span class="number">200</span></span><br></pre></td></tr></table></figure>

<h4 id="Lua-继承实例"><a href="#Lua-继承实例" class="headerlink" title="Lua 继承实例"></a>Lua 继承实例</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">-- Meta class</span></span><br><span class="line">Shape = &#123;area = <span class="number">0</span>&#125;</span><br><span class="line"><span class="comment">-- 基础类方法 new</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Shape:new</span> <span class="params">(o,side)</span></span></span><br><span class="line">  o = o <span class="keyword">or</span> &#123;&#125;</span><br><span class="line">  <span class="built_in">setmetatable</span>(o, <span class="built_in">self</span>)</span><br><span class="line">  <span class="built_in">self</span>.<span class="built_in">__index</span> = <span class="built_in">self</span></span><br><span class="line">  side = side <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line">  <span class="built_in">self</span>.area = side*side;</span><br><span class="line">  <span class="keyword">return</span> o</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 基础类方法 printArea</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Shape:printArea</span> <span class="params">()</span></span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;面积为 &quot;</span>,<span class="built_in">self</span>.area)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h4 id="函数重写"><a href="#函数重写" class="headerlink" title="函数重写"></a>函数重写</h4><p>Lua中我们可以重写基础类的函数，在派生类中定义自己的实现方式：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 派生类方法 printArea</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Square:printArea</span> <span class="params">()</span></span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;正方形面积 &quot;</span>,<span class="built_in">self</span>.area)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>


<h2 id="Lua-数据库访问"><a href="#Lua-数据库访问" class="headerlink" title="Lua 数据库访问"></a>Lua 数据库访问</h2><p>Lua 操作数据库的操作库： LuaSQL。是开源的支持ODBC, ADO, Oracle, MySQL, SQLite 和 PostgreSQL。<br>LuaSQL 可以使用 <a target="_blank" rel="noopener" href="https://luarocks.org/">LuaRocks</a> 来安装可以根据需要安装你需要的数据库驱动。<br>LuaRocks 安装方法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">wget http://luarocks.org/releases/luarocks-2.2.1.tar.gz</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tar zxpf luarocks-2.2.1.tar.gz</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> luarocks-2.2.1</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./configure; sudo make bootstrap</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo luarocks install luasocket</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">lua</span></span><br><span class="line">Lua 5.3.0 Copyright (C) 1994-2015 Lua.org, PUC-Rio</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">require <span class="string">&quot;socket&quot;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>安装不同数据库驱动：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">luarocks install luasql-sqlite3</span><br><span class="line">luarocks install luasql-postgres</span><br><span class="line">luarocks install luasql-mysql</span><br><span class="line">luarocks install luasql-sqlite</span><br><span class="line">luarocks install luasql-odbc</span><br></pre></td></tr></table></figure>

<p>Lua 连接MySQL实力：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span> <span class="string">&quot;luasql.mysql&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--创建环境对象</span></span><br><span class="line">env = luasql.mysql()</span><br><span class="line"></span><br><span class="line"><span class="comment">--连接数据库</span></span><br><span class="line">conn = env:connect(<span class="string">&quot;数据库名&quot;</span>,<span class="string">&quot;用户名&quot;</span>,<span class="string">&quot;密码&quot;</span>,<span class="string">&quot;IP地址&quot;</span>,端口)</span><br><span class="line"></span><br><span class="line"><span class="comment">--设置数据库的编码格式</span></span><br><span class="line">conn:<span class="built_in">execute</span><span class="string">&quot;SET NAMES UTF8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--执行数据库操作</span></span><br><span class="line">cur = conn:<span class="built_in">execute</span>(<span class="string">&quot;select * from role&quot;</span>)</span><br><span class="line"></span><br><span class="line">row = cur:fetch(&#123;&#125;,<span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--文件对象的创建</span></span><br><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&quot;role.txt&quot;</span>,<span class="string">&quot;w+&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> row <span class="keyword">do</span></span><br><span class="line">    var = <span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">&quot;%d %s\n&quot;</span>, row.id, row.name)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(var)</span><br><span class="line"></span><br><span class="line">    file:<span class="built_in">write</span>(var)</span><br><span class="line"></span><br><span class="line">    row = cur:fetch(row,<span class="string">&quot;a&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">file:<span class="built_in">close</span>()  <span class="comment">--关闭文件对象</span></span><br><span class="line">conn:<span class="built_in">close</span>()  <span class="comment">--关闭数据库连接</span></span><br><span class="line">env:<span class="built_in">close</span>()   <span class="comment">--关闭数据库环境</span></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Qeuroal
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://qeuroal.top/2024/11/16/218/" title="218. lua">http://qeuroal.top/2024/11/16/218/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/lua/" rel="tag"><i class="fa fa-tag"></i> lua</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/11/09/216/" rel="prev" title="216. dwm">
                  <i class="fa fa-angle-left"></i> 216. dwm
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/11/16/217/" rel="next" title="217. lua">
                  217. lua <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Qeuroal</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/Qeuroal" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.24/fancybox/fancybox.umd.js" integrity="sha256-oyhjPiYRWGXaAt+ny/mTMWOnN1GBoZDUQnzzgC7FRI4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
